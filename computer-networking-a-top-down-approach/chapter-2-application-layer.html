<!DOCTYPE html> <html><head>
		<title>Chapter 2 Application Layer</title>
		<base href="../">
		<meta id="root-path" root-path="../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="Congzhi's Notes Vault - Chapter 2 Application Layer">
		<meta property="og:title" content="Chapter 2 Application Layer">
		<meta property="og:description" content="Congzhi's Notes Vault - Chapter 2 Application Layer">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://congzhi.wiki/computer-networking-a-top-down-approach/chapter-2-application-layer.html">
		<meta property="og:image" content="https://congzhi.wiki/computer-networking-a-top-down-approach/pics/pasted-image-20240527021928.png">
		<meta property="og:site_name" content="Congzhi's Notes Vault">
		<meta name="author" content="Congzhi"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://congzhi.wiki/lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles">mjx-msqrt { display: inline-block; text-align: left; }
mjx-root { display: inline-block; white-space: nowrap; }
mjx-surd { display: inline-block; vertical-align: top; }
mjx-sqrt { display: inline-block; padding-top: 0.07em; }
mjx-sqrt > mjx-box { border-top: 0.07em solid; }
mjx-sqrt.mjx-tall > mjx-box { padding-left: 0.3em; margin-left: -0.3em; }
mjx-c.mjx-c221A::before { padding: 0.8em 0.853em 0.2em 0px; content: "√"; }
mjx-c.mjx-c2061::before { padding: 0px; content: ""; }
mjx-c.mjx-c1D442.TEX-I::before { padding: 0.704em 0.763em 0.022em 0px; content: "O"; }
mjx-c.mjx-c4B::before { padding: 0.683em 0.778em 0px 0px; content: "K"; }
mjx-c.mjx-c46::before { padding: 0.68em 0.653em 0px 0px; content: "F"; }
mjx-c.mjx-c7A::before { padding: 0.431em 0.444em 0px 0px; content: "z"; }
mjx-c.mjx-cD7::before { padding: 0.491em 0.778em 0px 0px; content: "×"; }
mjx-c.mjx-c4D::before { padding: 0.683em 0.917em 0px 0px; content: "M"; }
mjx-c.mjx-c1D43A.TEX-I::before { padding: 0.705em 0.786em 0.022em 0px; content: "G"; }
mjx-c.mjx-c70::before { padding: 0.442em 0.556em 0.194em 0px; content: "p"; }
mjx-c.mjx-cB1::before { padding: 0.666em 0.778em 0px 0px; content: "±"; }
mjx-c.mjx-c5F::before { padding: 0px 0.5em 0.062em 0px; content: "_"; }
mjx-mtable { display: inline-block; text-align: center; vertical-align: 0.25em; position: relative; box-sizing: border-box; border-spacing: 0px; border-collapse: collapse; }
mjx-mstyle[size="s"] mjx-mtable { vertical-align: 0.354em; }
mjx-labels { position: absolute; left: 0px; top: 0px; }
mjx-table { display: inline-block; vertical-align: -0.5ex; box-sizing: border-box; }
mjx-table > mjx-itable { vertical-align: middle; text-align: left; box-sizing: border-box; }
mjx-labels > mjx-itable { position: absolute; top: 0px; }
mjx-mtable[justify="left"] { text-align: left; }
mjx-mtable[justify="right"] { text-align: right; }
mjx-mtable[justify="left"][side="left"] { padding-right: 0px !important; }
mjx-mtable[justify="left"][side="right"] { padding-left: 0px !important; }
mjx-mtable[justify="right"][side="left"] { padding-right: 0px !important; }
mjx-mtable[justify="right"][side="right"] { padding-left: 0px !important; }
mjx-mtable[align] { vertical-align: baseline; }
mjx-mtable[align="top"] > mjx-table { vertical-align: top; }
mjx-mtable[align="bottom"] > mjx-table { vertical-align: bottom; }
mjx-mtable[side="right"] mjx-labels { min-width: 100%; }
mjx-mtr { display: table-row; text-align: left; }
mjx-mtr[rowalign="top"] > mjx-mtd { vertical-align: top; }
mjx-mtr[rowalign="center"] > mjx-mtd { vertical-align: middle; }
mjx-mtr[rowalign="bottom"] > mjx-mtd { vertical-align: bottom; }
mjx-mtr[rowalign="baseline"] > mjx-mtd { vertical-align: baseline; }
mjx-mtr[rowalign="axis"] > mjx-mtd { vertical-align: 0.25em; }
mjx-mtd { display: table-cell; text-align: center; padding: 0.215em 0.4em; }
mjx-mtd:first-child { padding-left: 0px; }
mjx-mtd:last-child { padding-right: 0px; }
mjx-mtable > * > mjx-itable > :first-child > mjx-mtd { padding-top: 0px; }
mjx-mtable > * > mjx-itable > :last-child > mjx-mtd { padding-bottom: 0px; }
mjx-tstrut { display: inline-block; height: 1em; vertical-align: -0.25em; }
mjx-labels[align="left"] > mjx-mtr > mjx-mtd { text-align: left; }
mjx-labels[align="right"] > mjx-mtr > mjx-mtd { text-align: right; }
mjx-mtd[extra] { padding: 0px; }
mjx-mtd[rowalign="top"] { vertical-align: top; }
mjx-mtd[rowalign="center"] { vertical-align: middle; }
mjx-mtd[rowalign="bottom"] { vertical-align: bottom; }
mjx-mtd[rowalign="baseline"] { vertical-align: baseline; }
mjx-mtd[rowalign="axis"] { vertical-align: 0.25em; }
mjx-stretchy-v.mjx-c5B mjx-beg mjx-c::before { content: "⎡"; padding: 1.154em 0.667em 0.645em 0px; }
mjx-stretchy-v.mjx-c5B mjx-ext mjx-c::before { content: "⎢"; width: 0.667em; }
mjx-stretchy-v.mjx-c5B mjx-end mjx-c::before { content: "⎣"; padding: 1.155em 0.667em 0.644em 0px; }
mjx-stretchy-v.mjx-c5B > mjx-end { margin-top: -1.799em; }
mjx-stretchy-v.mjx-c5B > mjx-ext { border-top-width: 1.769em; border-bottom-width: 1.769em; }
mjx-stretchy-v.mjx-c5D mjx-beg mjx-c::before { content: "⎤"; padding: 1.154em 0.667em 0.645em 0px; }
mjx-stretchy-v.mjx-c5D mjx-ext mjx-c::before { content: "⎥"; width: 0.667em; }
mjx-stretchy-v.mjx-c5D mjx-end mjx-c::before { content: "⎦"; padding: 1.155em 0.667em 0.644em 0px; }
mjx-stretchy-v.mjx-c5D > mjx-end { margin-top: -1.799em; }
mjx-stretchy-v.mjx-c5D > mjx-ext { border-top-width: 1.769em; border-bottom-width: 1.769em; }
mjx-c.mjx-c1D703.TEX-I::before { padding: 0.705em 0.469em 0.01em 0px; content: "θ"; }
mjx-c.mjx-c1D434.TEX-I::before { padding: 0.716em 0.75em 0px 0px; content: "A"; }
mjx-c.mjx-c5B::before { padding: 0.75em 0.278em 0.25em 0px; content: "["; }
mjx-c.mjx-c5D::before { padding: 0.75em 0.278em 0.25em 0px; content: "]"; }
mjx-c.mjx-c22EF::before { padding: 0.31em 1.172em 0px 0px; content: "⋯"; }
mjx-c.mjx-c22EE::before { padding: 1.3em 0.278em 0.03em 0px; content: "⋮"; }
mjx-c.mjx-c22F1::before { padding: 1.52em 1.282em 0px 0px; content: "⋱"; }
mjx-c.mjx-c1D44A.TEX-I::before { padding: 0.683em 1.048em 0.022em 0px; content: "W"; }
mjx-c.mjx-c1D444.TEX-I::before { padding: 0.704em 0.791em 0.194em 0px; content: "Q"; }
mjx-c.mjx-c3E::before { padding: 0.54em 0.778em 0.04em 0px; content: ">"; }
mjx-c.mjx-c1D70F.TEX-I::before { padding: 0.431em 0.517em 0.013em 0px; content: "τ"; }
mjx-c.mjx-c1D458.TEX-I::before { padding: 0.694em 0.521em 0.011em 0px; content: "k"; }
mjx-c.mjx-c2211.TEX-S2::before { padding: 0.95em 1.444em 0.45em 0px; content: "∑"; }
mjx-c.mjx-c3C::before { padding: 0.54em 0.778em 0.04em 0px; content: "<"; }
mjx-c.mjx-c44::before { padding: 0.683em 0.764em 0px 0px; content: "D"; }
mjx-c.mjx-c20::before { padding: 0px 0.25em 0px 0px; content: " "; }
mjx-c.mjx-c6D::before { padding: 0.442em 0.833em 0px 0px; content: "m"; }
mjx-c.mjx-c2D::before { padding: 0.252em 0.333em 0px 0px; content: "-"; }
mjx-c.mjx-c75::before { padding: 0.442em 0.556em 0.011em 0px; content: "u"; }
mjx-c.mjx-c6B::before { padding: 0.694em 0.528em 0px 0px; content: "k"; }
mjx-c.mjx-c52::before { padding: 0.683em 0.736em 0.022em 0px; content: "R"; }
mjx-c.mjx-c67::before { padding: 0.453em 0.5em 0.206em 0px; content: "g"; }
mjx-c.mjx-c45::before { padding: 0.68em 0.681em 0px 0px; content: "E"; }
mjx-c.mjx-c78::before { padding: 0.431em 0.528em 0px 0px; content: "x"; }
mjx-c.mjx-c220F.TEX-S2::before { padding: 0.95em 1.278em 0.45em 0px; content: "∏"; }
mjx-c.mjx-c2264::before { padding: 0.636em 0.778em 0.138em 0px; content: "≤"; }
mjx-c.mjx-c1D457.TEX-I::before { padding: 0.661em 0.412em 0.204em 0px; content: "j"; }
mjx-c.mjx-c1D435.TEX-I::before { padding: 0.683em 0.759em 0px 0px; content: "B"; }
mjx-c.mjx-c47::before { padding: 0.705em 0.785em 0.022em 0px; content: "G"; }
mjx-c.mjx-c4C::before { padding: 0.683em 0.625em 0px 0px; content: "L"; }
mjx-c.mjx-c42::before { padding: 0.683em 0.708em 0px 0px; content: "B"; }
mjx-c.mjx-c41::before { padding: 0.716em 0.75em 0px 0px; content: "A"; }
mjx-c.mjx-c43::before { padding: 0.705em 0.722em 0.021em 0px; content: "C"; }
mjx-c.mjx-c79::before { padding: 0.431em 0.528em 0.204em 0px; content: "y"; }
mjx-c.mjx-c6C::before { padding: 0.694em 0.278em 0px 0px; content: "l"; }
mjx-c.mjx-c69::before { padding: 0.669em 0.278em 0px 0px; content: "i"; }
mjx-c.mjx-c6E::before { padding: 0.442em 0.556em 0px 0px; content: "n"; }
mjx-c.mjx-c64::before { padding: 0.694em 0.556em 0.011em 0px; content: "d"; }
mjx-c.mjx-c65::before { padding: 0.448em 0.444em 0.011em 0px; content: "e"; }
mjx-c.mjx-c72::before { padding: 0.442em 0.392em 0px 0px; content: "r"; }
mjx-c.mjx-c4E::before { padding: 0.683em 0.75em 0px 0px; content: "N"; }
mjx-c.mjx-c68::before { padding: 0.694em 0.556em 0px 0px; content: "h"; }
mjx-c.mjx-c61::before { padding: 0.448em 0.5em 0.011em 0px; content: "a"; }
mjx-c.mjx-c48::before { padding: 0.683em 0.75em 0px 0px; content: "H"; }
mjx-c.mjx-c63::before { padding: 0.448em 0.444em 0.011em 0px; content: "c"; }
mjx-c.mjx-c74::before { padding: 0.615em 0.389em 0.01em 0px; content: "t"; }
mjx-c.mjx-c6F::before { padding: 0.448em 0.5em 0.01em 0px; content: "o"; }
mjx-c.mjx-c53::before { padding: 0.705em 0.556em 0.022em 0px; content: "S"; }
mjx-c.mjx-c54::before { padding: 0.677em 0.722em 0px 0px; content: "T"; }
mjx-c.mjx-c5A::before { padding: 0.683em 0.611em 0px 0px; content: "Z"; }
mjx-msup { display: inline-block; text-align: left; }
mjx-c.mjx-c38::before { padding: 0.666em 0.5em 0.022em 0px; content: "8"; }
mjx-c.mjx-c39::before { padding: 0.666em 0.5em 0.022em 0px; content: "9"; }
mjx-c.mjx-c73::before { padding: 0.448em 0.394em 0.011em 0px; content: "s"; }
mjx-c.mjx-c1D448.TEX-I::before { padding: 0.683em 0.767em 0.022em 0px; content: "U"; }
mjx-c.mjx-c37::before { padding: 0.676em 0.5em 0.022em 0px; content: "7"; }
mjx-c.mjx-c1D438.TEX-I::before { padding: 0.68em 0.764em 0px 0px; content: "E"; }
mjx-c.mjx-c1D6FC.TEX-I::before { padding: 0.442em 0.64em 0.011em 0px; content: "α"; }
mjx-c.mjx-c1D463.TEX-I::before { padding: 0.443em 0.485em 0.011em 0px; content: "v"; }
mjx-c.mjx-c1D6FD.TEX-I::before { padding: 0.705em 0.566em 0.194em 0px; content: "β"; }
mjx-c.mjx-c7C::before { padding: 0.75em 0.278em 0.249em 0px; content: "|"; }
mjx-c.mjx-c1D43C.TEX-I::before { padding: 0.683em 0.504em 0px 0px; content: "I"; }
mjx-mtext { display: inline-block; text-align: left; }
mjx-mfrac { display: inline-block; text-align: left; }
mjx-frac { display: inline-block; vertical-align: 0.17em; padding: 0px 0.22em; }
mjx-frac[type="d"] { vertical-align: 0.04em; }
mjx-frac[delims] { padding: 0px 0.1em; }
mjx-frac[atop] { padding: 0px 0.12em; }
mjx-frac[atop][delims] { padding: 0px; }
mjx-dtable { display: inline-table; width: 100%; }
mjx-dtable > * { font-size: 2000%; }
mjx-dbox { display: block; font-size: 5%; }
mjx-num { display: block; text-align: center; }
mjx-den { display: block; text-align: center; }
mjx-mfrac[bevelled] > mjx-num { display: inline-block; }
mjx-mfrac[bevelled] > mjx-den { display: inline-block; }
mjx-den[align="right"], mjx-num[align="right"] { text-align: right; }
mjx-den[align="left"], mjx-num[align="left"] { text-align: left; }
mjx-nstrut { display: inline-block; height: 0.054em; width: 0px; vertical-align: -0.054em; }
mjx-nstrut[type="d"] { height: 0.217em; vertical-align: -0.217em; }
mjx-dstrut { display: inline-block; height: 0.505em; width: 0px; }
mjx-dstrut[type="d"] { height: 0.726em; }
mjx-line { display: block; box-sizing: border-box; min-height: 1px; height: 0.06em; border-top: 0.06em solid; margin: 0.06em -0.1em; overflow: hidden; }
mjx-line[type="d"] { margin: 0.18em -0.1em; }
mjx-mrow { display: inline-block; text-align: left; }
mjx-munderover { display: inline-block; text-align: left; }
mjx-munderover:not([limits="false"]) { padding-top: 0.1em; }
mjx-munderover:not([limits="false"]) > * { display: block; }
mjx-msubsup { display: inline-block; text-align: left; }
mjx-script { display: inline-block; padding-right: 0.05em; padding-left: 0.033em; }
mjx-script > mjx-spacer { display: block; }
mjx-c.mjx-c210E.TEX-I::before { padding: 0.694em 0.576em 0.011em 0px; content: "h"; }
mjx-c.mjx-c3A::before { padding: 0.43em 0.278em 0px 0px; content: ":"; }
mjx-c.mjx-c1D464.TEX-I::before { padding: 0.443em 0.716em 0.011em 0px; content: "w"; }
mjx-c.mjx-c1D45A.TEX-I::before { padding: 0.442em 0.878em 0.011em 0px; content: "m"; }
mjx-c.mjx-c1D446.TEX-I::before { padding: 0.705em 0.645em 0.022em 0px; content: "S"; }
mjx-c.mjx-c1D454.TEX-I::before { padding: 0.442em 0.477em 0.205em 0px; content: "g"; }
mjx-c.mjx-c1D453.TEX-I::before { padding: 0.705em 0.55em 0.205em 0px; content: "f"; }
mjx-c.mjx-c1D465.TEX-I::before { padding: 0.442em 0.572em 0.011em 0px; content: "x"; }
mjx-c.mjx-c2217::before { padding: 0.465em 0.5em 0px 0px; content: "∗"; }
mjx-c.mjx-c1D447.TEX-I::before { padding: 0.677em 0.704em 0px 0px; content: "T"; }
mjx-c.mjx-cA0::before { padding: 0px 0.25em 0px 0px; content: " "; }
mjx-c.mjx-c34::before { padding: 0.677em 0.5em 0px 0px; content: "4"; }
mjx-c.mjx-c36::before { padding: 0.666em 0.5em 0.022em 0px; content: "6"; }
mjx-c.mjx-c2248::before { padding: 0.483em 0.778em 0px 0px; content: "≈"; }
mjx-c.mjx-c1D449.TEX-I::before { padding: 0.683em 0.769em 0.022em 0px; content: "V"; }
mjx-c.mjx-c1D43F.TEX-I::before { padding: 0.683em 0.681em 0px 0px; content: "L"; }
mjx-c.mjx-c1D436.TEX-I::before { padding: 0.705em 0.76em 0.022em 0px; content: "C"; }
mjx-c.mjx-c2265::before { padding: 0.636em 0.778em 0.138em 0px; content: "≥"; }
mjx-c.mjx-c7B::before { padding: 0.75em 0.5em 0.25em 0px; content: "{"; }
mjx-c.mjx-c7D::before { padding: 0.75em 0.5em 0.25em 0px; content: "}"; }
mjx-c.mjx-c1D443.TEX-I::before { padding: 0.683em 0.751em 0px 0px; content: "P"; }
mjx-c.mjx-c2211.TEX-S1::before { padding: 0.75em 1.056em 0.25em 0px; content: "∑"; }
mjx-container[jax="CHTML"] { line-height: 0; }
mjx-container [space="1"] { margin-left: 0.111em; }
mjx-container [space="2"] { margin-left: 0.167em; }
mjx-container [space="3"] { margin-left: 0.222em; }
mjx-container [space="4"] { margin-left: 0.278em; }
mjx-container [space="5"] { margin-left: 0.333em; }
mjx-container [rspace="1"] { margin-right: 0.111em; }
mjx-container [rspace="2"] { margin-right: 0.167em; }
mjx-container [rspace="3"] { margin-right: 0.222em; }
mjx-container [rspace="4"] { margin-right: 0.278em; }
mjx-container [rspace="5"] { margin-right: 0.333em; }
mjx-container [size="s"] { font-size: 70.7%; }
mjx-container [size="ss"] { font-size: 50%; }
mjx-container [size="Tn"] { font-size: 60%; }
mjx-container [size="sm"] { font-size: 85%; }
mjx-container [size="lg"] { font-size: 120%; }
mjx-container [size="Lg"] { font-size: 144%; }
mjx-container [size="LG"] { font-size: 173%; }
mjx-container [size="hg"] { font-size: 207%; }
mjx-container [size="HG"] { font-size: 249%; }
mjx-container [width="full"] { width: 100%; }
mjx-box { display: inline-block; }
mjx-block { display: block; }
mjx-itable { display: inline-table; }
mjx-row { display: table-row; }
mjx-row > * { display: table-cell; }
mjx-mtext { display: inline-block; }
mjx-mstyle { display: inline-block; }
mjx-merror { display: inline-block; color: red; background-color: yellow; }
mjx-mphantom { visibility: hidden; }
mjx-assistive-mml { top: 0px; left: 0px; clip: rect(1px, 1px, 1px, 1px); user-select: none; position: absolute !important; padding: 1px 0px 0px !important; border: 0px !important; display: block !important; width: auto !important; overflow: hidden !important; }
mjx-assistive-mml[display="block"] { width: 100% !important; }
mjx-math { display: inline-block; text-align: left; line-height: 0; text-indent: 0px; font-style: normal; font-weight: normal; font-size: 100%; letter-spacing: normal; border-collapse: collapse; overflow-wrap: normal; word-spacing: normal; white-space: nowrap; direction: ltr; padding: 1px 0px; }
mjx-container[jax="CHTML"][display="true"] { display: block; text-align: center; margin: 1em 0px; }
mjx-container[jax="CHTML"][display="true"][width="full"] { display: flex; }
mjx-container[jax="CHTML"][display="true"] mjx-math { padding: 0px; }
mjx-container[jax="CHTML"][justify="left"] { text-align: left; }
mjx-container[jax="CHTML"][justify="right"] { text-align: right; }
mjx-mi { display: inline-block; text-align: left; }
mjx-c { display: inline-block; }
mjx-utext { display: inline-block; padding: 0.75em 0px 0.2em; }
mjx-msub { display: inline-block; text-align: left; }
mjx-texatom { display: inline-block; text-align: left; }
mjx-mo { display: inline-block; text-align: left; }
mjx-stretchy-h { display: inline-table; width: 100%; }
mjx-stretchy-h > * { display: table-cell; width: 0px; }
mjx-stretchy-h > * > mjx-c { display: inline-block; transform: scaleX(1); }
mjx-stretchy-h > * > mjx-c::before { display: inline-block; width: initial; }
mjx-stretchy-h > mjx-ext { overflow: clip visible; width: 100%; }
mjx-stretchy-h > mjx-ext > mjx-c::before { transform: scaleX(500); }
mjx-stretchy-h > mjx-ext > mjx-c { width: 0px; }
mjx-stretchy-h > mjx-beg > mjx-c { margin-right: -0.1em; }
mjx-stretchy-h > mjx-end > mjx-c { margin-left: -0.1em; }
mjx-stretchy-v { display: inline-block; }
mjx-stretchy-v > * { display: block; }
mjx-stretchy-v > mjx-beg { height: 0px; }
mjx-stretchy-v > mjx-end > mjx-c { display: block; }
mjx-stretchy-v > * > mjx-c { transform: scaleY(1); transform-origin: left center; overflow: hidden; }
mjx-stretchy-v > mjx-ext { display: block; height: 100%; box-sizing: border-box; border: 0px solid transparent; overflow: visible clip; }
mjx-stretchy-v > mjx-ext > mjx-c::before { width: initial; box-sizing: border-box; }
mjx-stretchy-v > mjx-ext > mjx-c { transform: scaleY(500) translateY(0.075em); overflow: visible; }
mjx-mark { display: inline-block; height: 0px; }
mjx-mn { display: inline-block; text-align: left; }
mjx-c::before { display: block; width: 0px; }
.MJX-TEX { font-family: MJXZERO, MJXTEX; }
.TEX-B { font-family: MJXZERO, MJXTEX-B; }
.TEX-I { font-family: MJXZERO, MJXTEX-I; }
.TEX-MI { font-family: MJXZERO, MJXTEX-MI; }
.TEX-BI { font-family: MJXZERO, MJXTEX-BI; }
.TEX-S1 { font-family: MJXZERO, MJXTEX-S1; }
.TEX-S2 { font-family: MJXZERO, MJXTEX-S2; }
.TEX-S3 { font-family: MJXZERO, MJXTEX-S3; }
.TEX-S4 { font-family: MJXZERO, MJXTEX-S4; }
.TEX-A { font-family: MJXZERO, MJXTEX-A; }
.TEX-C { font-family: MJXZERO, MJXTEX-C; }
.TEX-CB { font-family: MJXZERO, MJXTEX-CB; }
.TEX-FR { font-family: MJXZERO, MJXTEX-FR; }
.TEX-FRB { font-family: MJXZERO, MJXTEX-FRB; }
.TEX-SS { font-family: MJXZERO, MJXTEX-SS; }
.TEX-SSB { font-family: MJXZERO, MJXTEX-SSB; }
.TEX-SSI { font-family: MJXZERO, MJXTEX-SSI; }
.TEX-SC { font-family: MJXZERO, MJXTEX-SC; }
.TEX-T { font-family: MJXZERO, MJXTEX-T; }
.TEX-V { font-family: MJXZERO, MJXTEX-V; }
.TEX-VB { font-family: MJXZERO, MJXTEX-VB; }
mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c { font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A !important; }
@font-face { font-family: MJXZERO; src: url("lib/fonts/mathjax_zero.woff") format("woff"); }
@font-face { font-family: MJXTEX; src: url("lib/fonts/mathjax_main-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-B; src: url("lib/fonts/mathjax_main-bold.woff") format("woff"); }
@font-face { font-family: MJXTEX-I; src: url("lib/fonts/mathjax_math-italic.woff") format("woff"); }
@font-face { font-family: MJXTEX-MI; src: url("lib/fonts/mathjax_main-italic.woff") format("woff"); }
@font-face { font-family: MJXTEX-BI; src: url("lib/fonts/mathjax_math-bolditalic.woff") format("woff"); }
@font-face { font-family: MJXTEX-S1; src: url("lib/fonts/mathjax_size1-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-S2; src: url("lib/fonts/mathjax_size2-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-S3; src: url("lib/fonts/mathjax_size3-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-S4; src: url("lib/fonts/mathjax_size4-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-A; src: url("lib/fonts/mathjax_ams-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-C; src: url("lib/fonts/mathjax_calligraphic-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-CB; src: url("lib/fonts/mathjax_calligraphic-bold.woff") format("woff"); }
@font-face { font-family: MJXTEX-FR; src: url("lib/fonts/mathjax_fraktur-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-FRB; src: url("lib/fonts/mathjax_fraktur-bold.woff") format("woff"); }
@font-face { font-family: MJXTEX-SS; src: url("lib/fonts/mathjax_sansserif-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-SSB; src: url("lib/fonts/mathjax_sansserif-bold.woff") format("woff"); }
@font-face { font-family: MJXTEX-SSI; src: url("lib/fonts/mathjax_sansserif-italic.woff") format("woff"); }
@font-face { font-family: MJXTEX-SC; src: url("lib/fonts/mathjax_script-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-T; src: url("lib/fonts/mathjax_typewriter-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-V; src: url("lib/fonts/mathjax_vector-regular.woff") format("woff"); }
@font-face { font-family: MJXTEX-VB; src: url("lib/fonts/mathjax_vector-bold.woff") format("woff"); }
mjx-c.mjx-c1D437.TEX-I::before { padding: 0.683em 0.828em 0px 0px; content: "D"; }
mjx-c.mjx-c1D452.TEX-I::before { padding: 0.442em 0.466em 0.011em 0px; content: "e"; }
mjx-c.mjx-c1D459.TEX-I::before { padding: 0.694em 0.298em 0.011em 0px; content: "l"; }
mjx-c.mjx-c1D44E.TEX-I::before { padding: 0.441em 0.529em 0.01em 0px; content: "a"; }
mjx-c.mjx-c1D466.TEX-I::before { padding: 0.442em 0.49em 0.205em 0px; content: "y"; }
mjx-c.mjx-c1D45B.TEX-I::before { padding: 0.442em 0.6em 0.011em 0px; content: "n"; }
mjx-c.mjx-c1D45C.TEX-I::before { padding: 0.441em 0.485em 0.011em 0px; content: "o"; }
mjx-c.mjx-c1D451.TEX-I::before { padding: 0.694em 0.52em 0.01em 0px; content: "d"; }
mjx-c.mjx-c3D::before { padding: 0.583em 0.778em 0.082em 0px; content: "="; }
mjx-c.mjx-c1D45D.TEX-I::before { padding: 0.442em 0.503em 0.194em 0px; content: "p"; }
mjx-c.mjx-c1D45F.TEX-I::before { padding: 0.442em 0.451em 0.011em 0px; content: "r"; }
mjx-c.mjx-c1D450.TEX-I::before { padding: 0.442em 0.433em 0.011em 0px; content: "c"; }
mjx-c.mjx-c2B::before { padding: 0.583em 0.778em 0.082em 0px; content: "+"; }
mjx-c.mjx-c1D45E.TEX-I::before { padding: 0.442em 0.46em 0.194em 0px; content: "q"; }
mjx-c.mjx-c1D462.TEX-I::before { padding: 0.442em 0.572em 0.011em 0px; content: "u"; }
mjx-c.mjx-c1D461.TEX-I::before { padding: 0.626em 0.361em 0.011em 0px; content: "t"; }
mjx-c.mjx-c1D460.TEX-I::before { padding: 0.442em 0.469em 0.01em 0px; content: "s"; }
mjx-c.mjx-c2212::before { padding: 0.583em 0.778em 0.082em 0px; content: "−"; }
mjx-c.mjx-c1D441.TEX-I::before { padding: 0.683em 0.888em 0px 0px; content: "N"; }
mjx-c.mjx-c28::before { padding: 0.75em 0.389em 0.25em 0px; content: "("; }
mjx-c.mjx-c29::before { padding: 0.75em 0.389em 0.25em 0px; content: ")"; }
mjx-c.mjx-c1D445.TEX-I::before { padding: 0.683em 0.759em 0.021em 0px; content: "R"; }
mjx-c.mjx-c1D440.TEX-I::before { padding: 0.683em 1.051em 0px 0px; content: "M"; }
mjx-c.mjx-c1D456.TEX-I::before { padding: 0.661em 0.345em 0.011em 0px; content: "i"; }
mjx-c.mjx-c31::before { padding: 0.666em 0.5em 0px 0px; content: "1"; }
mjx-c.mjx-c2C::before { padding: 0.121em 0.278em 0.194em 0px; content: ","; }
mjx-c.mjx-c32::before { padding: 0.666em 0.5em 0px 0px; content: "2"; }
mjx-c.mjx-c33::before { padding: 0.665em 0.5em 0.022em 0px; content: "3"; }
mjx-c.mjx-c2E::before { padding: 0.12em 0.278em 0px 0px; content: "."; }
mjx-c.mjx-c1D439.TEX-I::before { padding: 0.68em 0.749em 0px 0px; content: "F"; }
mjx-c.mjx-c2F::before { padding: 0.75em 0.5em 0.25em 0px; content: "/"; }
mjx-c.mjx-c1D44F.TEX-I::before { padding: 0.694em 0.429em 0.011em 0px; content: "b"; }
mjx-c.mjx-c35::before { padding: 0.666em 0.5em 0.022em 0px; content: "5"; }
mjx-c.mjx-c30::before { padding: 0.666em 0.5em 0.022em 0px; content: "0"; }
mjx-c.mjx-c1D43E.TEX-I::before { padding: 0.683em 0.889em 0px 0px; content: "K"; }
mjx-c.mjx-c1D43B.TEX-I::before { padding: 0.683em 0.888em 0px 0px; content: "H"; }
</style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">tags</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Network</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Chapter 2: Application Layer"><p dir="auto">Chapter 2: Application Layer</p></h1><div class="el-h1 heading-wrapper"><div class="heading-children"><div class="el-p"><p dir="auto"><em>Network applications are the raisons d’être of a computer network—if we couldn’t conceive of any useful applications, there wouldn’t be any need for networking infrastructure and protocols to support them.</em></p></div><div class="el-h2 heading-wrapper"><h2 data-heading="2.1 Principals of Network Applications" dir="auto" class="heading" id="2.1_Principals_of_Network_Applications"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1 Principals of Network Applications</h2><div class="heading-children"><div class="el-p"><p dir="auto">当我们有一个网络应用的点子时，我们得先明白现实世界中的网络应用是如何运行的。在网络应用最核心的开发任务就是编写能够跑在不同终端并使得它们可以经由网络核心(network core)互相通信的程序代码。在Web应用中，有两类应用不断地互相通信，一类是运行在用户host上的浏览程序(browser program)，另一类是运行在Web服务器上的Web服务程序(Web server program)。<br>
<span alt="Pasted image 20240527021928.png" src="Pasted image 20240527021928.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240527021928.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240527021928.png"></span></p></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.1.1 Network Application Architectures" dir="auto" class="heading" id="2.1.1_Network_Application_Architectures"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1.1 Network Application Architectures</h3><div class="heading-children"><div class="el-p"><p dir="auto">应用程序开发者的角度来看，网络架构是固定的(fixed)，并且为应用程序提供了一套特定的服务。换句话说，当开发者创建应用程序时，他们可以依赖这个预先定义好的网络架构来构建功能，而不需要关心网络的底层细节。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">在<strong>application architectures</strong>的选择上应用程序员通常会从下面当今主流的两种结构中进行选择：<br>
<strong>1.The client-server architecture:</strong><br>
- 在<strong>客户机-服务器体系结构</strong>下，<mark>服务器总会一直运行</mark>等待客户机的服务请求。当Web服务器收到来自客户机的请求对象服务时，服务器就会返回被请求的对象。<br>
- 这种体系结构有一些特点值得我们注意：在客户机-服务器模式下client-hosts不能直接通信；<mark>而且服务器有一个固定且周知的地址</mark>，我们称为<strong>IP地址</strong>。因而，客户机总能通过发送packet数据包的方式和服务器进行通信连接。<br>
- 遵从客户机-服务器模式的应用有<strong>Web, FTP, Telnet, e-mail</strong>等。<br>
- 通常情况下，单服务器不足以响应来自客户机的所有请求，which can be overwhelmed to the server. 因此，<strong>数据中心(Data center)</strong> 应运而生。我们熟知的各种搜索引擎和很多大型社交应用就是运行在散布世界各地的data center上的。<br>
<strong>2.The peer-to-peer (P2P) architecture</strong>（P2P file sharing system）<br>
- 和客户机-服务器体系结构严重依赖数据中心不同，<mark><strong>对等网络</strong>的应用</mark>对数据中心几乎没有依赖，它们通过hosts在网络上的互联间接的通信。<br>
- P2P体系结构中的每个host(被称为peer)即充当着服务器的角色——响应其他peer host的服务请求的同时它们也充当着客户机的角色——向其他peer host发起服务请求。<br>
- 这些对等体不受服务提供商所有，它们运行在用户所有的终端设备上。因为这些对等体应用之间的通信不经由data center，因而被叫做peer-to-peer。<br>
- P2P体系结构最引人入胜的特性就是<mark><strong>自扩展性(self-scalability)</strong></mark>。这意味着每当新用户加入P2P网络，网络的总体带宽和资源分发能力也随着新用户的加入而增长。这是因为新用户不仅从网络中下载内容，同时也成为了内容的分发者。而不是像传统的客户机-服务器模型那样，服务器的负载随用户数量增加而线性增长。例如，在BitTorrent这样的P2P文件分享系统中，每个用户在下载文件的同时，也会上传已经下载的文件部分给其他用户。这样，文件的分发不再依赖于单一的服务器，而是由网络中的所有用户共同完成，从而实现了自扩展。<br>
- <strong>Cost effective</strong>，因为P2P体系结构对数据中心的依赖降低，因此可以在组件data center服务器上省下一大笔开销。<br>
<span alt="Pasted image 20240527032107.png" src="Pasted image 20240527032107.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240527032107.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240527032107.png"></span></li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.1.2 Processes Communicating" dir="auto" class="heading" id="2.1.2_Processes_Communicating"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1.2 Processes Communicating</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">当程序载入内存在host上运行的时候，它就变成了<strong>进程(process)</strong>。当我们说不同end systems之间的通信时，实际上是Application layer之间的通信，即不同宿主机中进程的通信。在计算机网络课程中，我们不关心同一宿主机里的进程间通信。</li>
<li data-line="1" dir="auto">不同终端间的进程通过计算机网络<strong>交换报文(exchanging messages)</strong> 来与彼此通信。 发送进程创建报文并将其转发到网络上；接收进程接收这些报文并作出回应。</li>
</ul></div><div class="el-h5 heading-wrapper"><h5 data-heading="Client and Server Processes" dir="auto" class="heading" id="Client_and_Server_Processes"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Client and Server Processes</h5><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>一个网络应用要实现不同end system上进程的通信，就要包括一对进程，即：<br>
（1）发送报文的进程——我们将其标为Server；<br>
（2）接收报文的进程——我们将其标为Client。
<ul>
<li data-line="3" dir="auto">在客户机-服务器体系结构下，孰是客户机孰是服务器很好辨别，因为服务器(Content Service Provider)总是向客户机(User's host)发送报文信息。</li>
<li data-line="4" dir="auto">在P2P体系结构下，end system的身份就相对模糊起来。因为peer host即可能是上传信息的一方(响应请求)，也可能是下载信息(发起请求)的一方。</li>
</ul>
</li>
<li data-line="5" dir="auto">我们对client和server的定义如下:<br>
<mark><em>In the context of a communication session between a pair of processes, the process that initiates the communication (that is, initially contacts the other process at the beginning of the session) is labeled as the client. The process that waits to be contacted to begin the session is the server.</em></mark><br>
即发起会话请求的是客户端(客户端请求)，接收并反映请求的是服务器端(服务器端回应)。</li>
</ul></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="The Interface Between the Process and the Computer Network" dir="auto" class="heading" id="The_Interface_Between_the_Process_and_the_Computer_Network"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>The Interface Between the Process and the Computer Network</h5><div class="heading-children"><div class="el-p"><p dir="auto">从一个进程向另一个进程传输的报文都要经由下层网络。我们之前提到：计算机网络的下层是为上层的服务而存在的。在这里我们会有疑问，网络栈中 <em>应用层</em> 和 <em>传输层</em> 之间的接口是什么呢？这个处于应用和网络之间的<strong>软件接口API</strong>就叫做<strong>Socket</strong>——应用进程与传输层协议间的接口。<br>
<span alt="Pasted image 20240527174749.png" src="Pasted image 20240527174749.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240527174749.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240527174749.png"></span></p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">在网络应用开发时，开发者只对<strong>socket接口的应用层一侧</strong>有完全的掌握，但对传输层一侧几乎没有控制。但开发者对传输层一侧能够控制的有：<br>
（1）传输层协议(choice of transport protocol)<br>
（2）修改一些传输层的参数(ability to fix a few transport-layer parameters)</li>
</ul></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Addressing Processes" dir="auto" class="heading" id="Addressing_Processes"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Addressing Processes</h5><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">要实现两进程之间的通信，我们就得先知道destination process的地址是什么。要知道目标进程的确切地址，我们需要知道：<br>
（1）主机地址——<strong>IP address</strong><br>
（2）区别目标主机的接收进程的标识——<strong>Port number</strong><br>
<em>Popular applications have been assigned specific port numbers. For example, a Web server is identified by port number 80. A mail server process (using the SMTP protocol) is identified by port number 25. A list of well-known port numbers for all Internet standard protocols can be found at <a data-tooltip-position="top" aria-label="http://www.iana.org." rel="noopener nofollow" class="external-link" href="http://www.iana.org." target="_blank">www.iana.org.</a> We’ll examine port numbers in detail later</em></li>
</ul></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.1.3 Transport Services Available to Applications" dir="auto" class="heading" id="2.1.3_Transport_Services_Available_to_Applications"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1.3 Transport Services Available to Applications</h3><div class="heading-children"><div class="el-p"><p dir="auto">前文提到<strong>Socket</strong>是应用进程与传输层协议间的接口，应用进程的发送方将报文信息经由socket传给<strong>传输层协议</strong>——which has the responsibility of getting the messages to the socket of the receiving process. 因此，开发者在开发应用时必须选择一个<strong>传输层协议</strong>来保证报文从网络层向传输层的正常传递。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>在传输层协议的选择上我们往往会考虑如下方面：
<ul>
<li data-line="1" dir="auto">数据传输的可靠度</li>
<li data-line="2" dir="auto">吞吐率</li>
<li data-line="3" dir="auto">时延</li>
<li data-line="4" dir="auto">安全性</li>
</ul>
</li>
</ul></div><div class="el-h5 heading-wrapper"><h5 data-heading="Reliable Data Transfer" dir="auto" class="heading" id="Reliable_Data_Transfer"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Reliable Data Transfer</h5><div class="heading-children"><div class="el-p"><p dir="auto">我们之前了解过，数据包packet在进程到进程传输过程中可能发生丢失、某些bit位出错的情况。在一些如e-mail、金融软件和文件传输的情况时，数据丢失可能造成严重的后果。为保证数据传输时的包完整度，一些协议提供这种<strong>可靠的信息传输</strong>。一旦传输层协议提供这种服务，发送进程即可将信息包传给socket且保证在信息传输过程中的不出错。</p></div><div class="el-p"><p dir="auto">一些协议不提供这样的可靠性，这样的协议可能为那些<strong>loss-tolerant applications</strong>所用。比如一些音视频的多媒体应用，它们容许在信息传出中一定量的数据丢失。</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Throughput" dir="auto" class="heading" id="Throughput"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Throughput</h5><div class="heading-children"><div class="el-p"><p dir="auto">吞吐率是用来衡量sending process能够向receiving process传输bit的速率大小。我们已经学习过在网络路径上可能不止一条通信会话，可能会有多个会话共享网络路径的带宽，<strong>随着其他会话的上线下线，可用带宽会随时间发生变化</strong>。这种现象自然地引出另一种传输层提供的服务——<strong>guaranteed available throughput at some specified rate</strong>。有这种服务的保证，应用可用要求一个最低r bits/sec的最小吞吐率，这对那些<strong>带宽敏感的应用</strong>是极为需要的。一些对吞吐率变化不敏感的应用——<strong>弹性应用(elastic application)</strong> 对这种保证性服务就没有这么需要了。</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Timing" dir="auto" class="heading" id="Timing"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Timing</h5><div class="heading-children"><div class="el-p"><p dir="auto">传输层协议也可以提供时间保证(time guaranteed)的服务。Timing guarantees 可以多种方式提供给应用进程，如guarantee might be that every bit that the sender pumps into the socket arrives at the receiver’s socket no more than 100 msec later.</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Security" dir="auto" class="heading" id="Security"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Security</h5><div class="heading-children"><div class="el-p"><p dir="auto">传输层也会向应用提供一个或多个<strong>安全服务(Security services)</strong>。例如，在发送端，传输层可以加密(encrypt)发送进程所发送的所有信息，并在接收端的传输层解密(decrypt)后将信息传给接收进程。</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.1.4 Transport Services Provided by the Internet" dir="auto" class="heading" id="2.1.4_Transport_Services_Provided_by_the_Internet"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1.4 Transport Services Provided by the Internet</h3><div class="heading-children"><div class="el-p"><p dir="auto">The Internet(通常上是TCP/IP协议族网络)，向应用提供两种传输协议——TCP和UDP。开发人员在开发网络应用时，最先考虑的问题之一就是应用应当使用TCP协议还是UDP协议。这两个协议中的每种协议都提供了不同的服务集。<br>
<span alt="Pasted image 20240528195845.png" src="Pasted image 20240528195845.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240528195845.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240528195845.png"></span></p></div><div class="el-h5 heading-wrapper"><h5 data-heading="TCP Services" dir="auto" class="heading" id="TCP_Services"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>TCP Services</h5><div class="heading-children"><div class="el-p"><p dir="auto"><mark><strong>TCP服务模型</strong></mark>涵括了<strong>面向连接的服务</strong>和<strong>可靠数据传输的服务</strong>，当选用TCP作为其传输层协议时，应用就获得了TCP所提供的这两种服务。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><em>Connection-oriented service</em> ：在报文开始传输前，TCP要求客户端和服务器端互换传输层信息，这也称作<strong>握手(handshaking)</strong>。握手阶段完成之后，一个进程socket间的<strong>TCP connection</strong>就建立完成了，这个连接是<strong>全双工</strong>的。当报文发送结束，应用就必须切断连接。</li>
<li data-line="1" dir="auto"><em>Reliable data transfer service</em>：依靠TCP协议通信的进程所发送的所有信息都是顺序正确且无误的。TCP也提供拥塞控制机制(congestion-control mechanism)，当接发双方间存在拥塞时，TCP拥塞控制机制会遏制发送进程继续发送报文。</li>
</ul></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="UDP Services" dir="auto" class="heading" id="UDP_Services"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>UDP Services</h5><div class="heading-children"><div class="el-p"><p dir="auto">相比TCP，UDP是”轻便“简洁的，它没有一些附加功能，是一种轻量的传输协议。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">UDP是无连接的，因此传输报文前不需要握手。</li>
<li data-line="1" dir="auto">UDP也不提供可靠传输服务，因此不保证接收进程收到报文的完整和准确性。</li>
<li data-line="2" dir="auto">UDP也不提供拥塞控制机制。</li>
</ul></div><div class="el-p"><p dir="auto">*<strong><em>Note that</em></strong> neither of these two protocol provides any securing encryption.<strong>Transport Layer Security</strong> (TLS) is Internet community developing for TCP enhancement. It's not provided by TCP<br>
or UDP itself.</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Services Not Provided by Internet Transport Protocols" dir="auto" class="heading" id="Services_Not_Provided_by_Internet_Transport_Protocols"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Services Not Provided by Internet Transport Protocols</h5><div class="heading-children"><div class="el-p"><p dir="auto">我们之前通过四个维度总结传输层协议提供的服务：可靠数据传输、吞吐率、timing、安全性。在前面谈论TCP和UDP所提供服务时都漏掉时间和吞吐率保证，这是因为<mark>现今的传输层协议不提供时间和吞吐率的保证服务</mark>。但这不意为着不能使用Internet拨打电话或视频通话。这是因为如今的互联网可以为time-sensitive application提供满意的服务，但不提供任何timing和throughput的保证。<br>
<span alt="Pasted image 20240528210914.png" src="Pasted image 20240528210914.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240528210914.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240528210914.png"></span></p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.1.5 Application-Layer Protocols" dir="auto" class="heading" id="2.1.5_Application-Layer_Protocols"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1.5 Application-Layer Protocols</h3><div class="heading-children"><div class="el-p"><p dir="auto">我们已经了解到网络进程间的通信是通过socket这个API实现的。但我们仍不了解关于messages报文是如何构造的？报文中不同fields的含义是什么？进程何时发送报文？<strong>Application-layer protocol</strong>会告诉我们答案。一个应用层协议的具体定义如下：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">The types of messages exchanged, for example, request messages and response messages </li>
<li data-line="1" dir="auto">The syntax of the various message types, such as the fields in the message and how the fields are delineated </li>
<li data-line="2" dir="auto">The semantics of the fields, that is, the meaning of the information in the fields </li>
<li data-line="3" dir="auto">Rules for determining when and how a process sends messages and responds to messages</li>
</ul></div><div class="el-p"><p dir="auto">一些应用层协议在RFC中能够找到详细定义，如HTTP；但也有一些应用层协议作为财产专利不公之于众，如Skype。<br>
弄明白网络应用和应用层协议的区别很重要，<mark>应用层协议知识网络应用的一部分</mark>，我们举一个例子：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><strong>Web</strong>&nbsp;是一个客户端-服务器应用，允许用户按需从Web服务器获取文档。</li>
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>Web应用</strong>&nbsp;包含多个组件，比如：
<ul>
<li data-line="2" dir="auto">文档格式的标准（即HTML）</li>
<li data-line="3" dir="auto">Web浏览器（例如Chrome和Microsoft Internet Explorer）</li>
<li data-line="4" dir="auto">Web服务器（例如Apache和Microsoft服务器）</li>
</ul>
</li>
<li data-line="5" dir="auto"><strong>应用层协议</strong>，即HTTP，定义了浏览器和Web服务器之间交换的消息的格式和顺序。</li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.1.6 Network Applications Covered in This Book" dir="auto" class="heading" id="2.1.6_Network_Applications_Covered_in_This_Book"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1.6 Network Applications Covered in This Book</h3><div class="heading-children"><div class="el-p"><p dir="auto">网络应用日新月异，第二章将以其中一小部分切入讲解：<strong>the Web, electronic mail, directory service, video streaming, and P2P applications</strong>。它们应用最广泛且易于理解。</p></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="2.2 The Web and HTTP" dir="auto" class="heading" id="2.2_The_Web_and_HTTP"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2 The Web and HTTP</h2><div class="heading-children"><div class="el-p"><p dir="auto">90年代初期之前，网络只能做一些很简单的应用。后来，现象级的应用横空出世——<strong>World Wide Web</strong>。Web应用是第一个进入大众视线的Internet应用。Web的出现极大地改变了人们在工作环境内外的互动方式，使得互联网从众多数据网络中脱颖而出，成为了基本上唯一的全球性数据网络。</p></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.2.1 Overview of HTTP" dir="auto" class="heading" id="2.2.1_Overview_of_HTTP"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.1 Overview of HTTP</h3><div class="heading-children"><div class="el-p"><p dir="auto"><strong>超文本传输协议(HyperText Tranfer Protocol)</strong> 是Web应用在应用层中的核心协议。HTTP完成两份程序——客户端程序和服务器程序，这些程序运行在不同的end system上并通过HTTP报文相互通信。HTTP规定了应用报文的格式和这些报文传输的方式。</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="HTTP相关概念" dir="auto" class="heading" id="HTTP相关概念"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTP相关概念</h5><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">A <strong>Web page(document)</strong> 包含了许多对象(文件)，例如<strong>HTML</strong>文件 、JPEG图片、JS文件、CCS格式的文本文件或一段视频等。一般的Web pages包括一个<strong>base HTML file</strong>和若干相关对象(如一些图片)组成。这些文件都有一个单一的<strong>URL(Uniform Resource Locator)</strong> 所标记，目标gif的URL的格式如下：<br>
<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3A"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D454 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D453 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span><br>
其中<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span>是服务器主机地址，而<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D454 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D453 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> 则是一个路径名。</li>
<li data-line="3" dir="auto">在Web应用中我们一般使用<strong>Web browser</strong>和<strong>Web server</strong>来表示Web应用的Client side或Server side。Web server通常由一个URL地址表示。它们都是遵循HTTP协议的程序，规范了Web clients向Web server索求Web pages的方式和Web servers向Web clients传输Web pages的方式。</li>
<li data-line="4" dir="auto">下图展示了一个简单的HTTP报文传输过程：首先Web clients通过HTTP请求报文向Web server发送一个网页对象的请求，随后server收到请求并通过包含对象的HTTP响应报文以响应。<br>
<span alt="Pasted image 20240603225246.png" src="Pasted image 20240603225246.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240603225246.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240603225246.png"></span></li>
<li data-line="6" dir="auto">由于传输过程中对准确性的要求，HTTP协议使用TCP作为下层的传输层。HTTP clent先初始化与server的TCP连接，一旦连接被建立，browser进程和server进程就可以通过其socket 接口进行TCP的通信。当client将报文发送到socket 接口之后，报文就进到TCP的掌握之中。之后，不论报文信息丢失还是恢复，这些都不是HTTP所关心的范畴(而是传输层及下面协议所关注的内容)。</li>
<li data-line="7" dir="auto">需要留意的是HTTP server在向HTTP client发送请求文件时，并<mark>不记录关于client的任何信息</mark>。因而，当client在短时间向server发送两次关于同一对象的请求报文时，server会死板地再次发送请求文件。正是HTTP server不保存clients的信息，HTTP因此被称作<strong>stateless protocol</strong>。</li>
</ul></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.2.2 Non-Persistent and Persistent Connection" dir="auto" class="heading" id="2.2.2_Non-Persistent_and_Persistent_Connection"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.2 Non-Persistent and Persistent Connection</h3><div class="heading-children"><div class="el-p"><p dir="auto">在许多Internet应用中，client和server会彼此相互通信很长一段时间。在这一大段时间里，client发送一系列请求，server回应这一系列请求。因此，我们产生了一个疑问：这些请求-响应是应该通过<strong>多个不同的(<em>separate</em>)TCP连接</strong>发送？还是通过<strong>一个保持连接的(<em>same</em>)TCP连接</strong>发送？</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="HTTP with Non-Persistent Connections" dir="auto" class="heading" id="HTTP_with_Non-Persistent_Connections"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTP with Non-Persistent Connections</h5><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>我们先介绍<strong>非持续连接</strong>的HTTP协议。假设网页中由一个base HTML和10张JPEG图片，也就是11个对象在同一个服务器resident。以下是base HTML的URL：<br>
<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3A"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span><br>
在整个非持续链接的过程中发生了： 
<ol>
<li data-line="3" dir="auto">HTTP client 通过<mark><strong>端口80</strong></mark><strong>初始化与服务器<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> 的TCP连接</strong>。其中80号端口是HTTP默认的端口号。同建立的TCP连接一道建立的还有client side和server side各自的socket 接口。</li>
<li data-line="4" dir="auto">HTTP client通过其socket向HTTP server发送一个请求报文，其中包括着路径名<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> (We will discuss HTTP messages in some detail below.)</li>
<li data-line="5" dir="auto">HTTP server通过其socket收到来自client的请求报文，从memory(RAM或disk)中读出请求对象<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span>的内容， 将对象在HTTP应答报文中进行封装并从其socket中向client送出应答报文。</li>
<li data-line="6" dir="auto">HTTP 服务进程告诉TCP关闭TCP连接。</li>
<li data-line="7" dir="auto">client process收到响应报文，<strong>TCP连接关闭</strong></li>
<li data-line="8" dir="auto">重复直到客户端进程收到所有网页对象。<br>
以上的步骤展示了一个非持续链接的例子，下一个对象的传输与上一个对象请求所建立的TCP连接没有关系（可以串行也可以一定程度的并行传输）。<strong>HTTP/1.0</strong>采用的就是这样的非持续连接的方式。</li>
</ol>
</li>
<li data-line="10" dir="auto">在学习Persistent Connections前，我们先了解以下<strong>RTT(Round Trip Time)</strong> 的概念。RTT是一个small packet（因为包很小，因此不考虑传输时延）从客户端进程到服务器进程再回到客户端进程的时间，与包传播时延、包排队时延、包处理时延有关。下图示例中，从用户点击一个超链接(hyperlink)开始，总共的响应时间粗略地计算为:<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D445 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D447 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D447 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D453 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D453 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-math></mjx-container></span><span alt="Pasted image 20240604010021.png" src="Pasted image 20240604010021.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240604010021.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240604010021.png"></span></li>
</ul></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="HTTP with Persistent Connections" dir="auto" class="heading" id="HTTP_with_Persistent_Connections"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTP with Persistent Connections</h5><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">通过上面对非持续连接的HTTP的学习，我们能够看到这种方式的缺点是非常明显的：每一次的对象请求都需要建立一个全新的TCP连接。如此，必须额外地分配TCP buffer且TCP variables必须在client side和server side二者中保存起来。这样的特点使得Web server的burden会是十分严重的。而且每次重新建立TCP的初始化连接还会额外地浪费一次RTT的时间。</li>
<li data-line="1" dir="auto"><mark><strong>提供持续连接的HTTP/1.1</strong></mark>，server会在发送响应报文后仍然打开TCP连接。之后client和server之间的请求和回应就都将建立在同一个已建立的TCP连接上。如此一来，每次请求和应答就免去了TCP连接初始化的步骤，省去一个RTT时间。</li>
</ul></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.2.3 HTTP Message Format" dir="auto" class="heading" id="2.2.3_HTTP_Message_Format"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.3 HTTP Message Format</h3><div class="heading-children"><div class="el-p"><p dir="auto"> HTTP的规定了<strong>HTTP报文格式(HTTP massage formats)</strong> 。HTTP报文有两种格式：（1）HTTP请求报文格式（2）HTTP响应报文格式 。</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="HTTP Request Massage" dir="auto" class="heading" id="HTTP_Request_Massage"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTP Request Massage</h5><div class="heading-children"><div class="el-p"><p dir="auto">下面我们给出一个简单的HTTP请求报文：</p></div><div class="el-pre"><pre><code data-line="0">GET /somedir/page.html HTTP/1.1 
Host: www.someschool.edu 
Connection: close 
User-agent: Mozilla/5.0 
Accept-language: fr
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>其中我们可以了解很多信息。首先，HTTP报文是用ASCII码编写的，因此我们可以通过阅读轻易了解其中的含义。为方便阅读，每一行以一个回车符(CR)和一个换行符(LF)作为结束，将报文划分为“五行”。最后一行额外地多一个CR和LF。
<ol>
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTP请求报文的<strong>第一行</strong>叫作<strong>请求行(Request line)</strong> 。请求行有三个字段(field)：HTTP方法字段、URL字段、HTTP版本字段。
<ul>
<li data-line="2" dir="auto">方法字段多个不同的操作方式，<code>GET</code>、<code>POST</code>、<code>HEAD</code>、<code>PUT</code>和<code>DELETE</code>。本例中请求操作方式是<code>GET</code>，表示浏览器向服务器请求一个对象。</li>
<li data-line="3" dir="auto">Method field中所请求操作的对象就放在URL字段中。</li>
<li data-line="4" dir="auto">最后版本信息在版本字段中表示。本例中HTTP版本为HTTP/1.1。</li>
</ul>
</li>
<li data-line="5" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTP请求报文之后的行(lines)的叫做<strong>头部行(Header lines)</strong>。
<ul>
<li data-line="6" dir="auto">头部行<code>Host: www.someschool.edu </code>指明了对象所在的host位置。</li>
<li data-line="7" dir="auto">头部行<code>Connection: close </code>表示浏览器告诉服务器在自己接收到目标报文后关闭TCP连接。</li>
<li data-line="8" dir="auto">头部行<code>User-agent: Mozilla/5.0</code> 是发起此请求浏览器的种类。</li>
<li data-line="9" dir="auto">头部行<code>Accept-language: fr</code>向服务器指明用户期望得到一个法语版本的html对象。</li>
</ul>
</li>
<li data-line="10" dir="auto">在下图中，我们发现在头部行的下面还有一片<strong>实体空间</strong>在例子中没有得到体现，这是因为一般在<code>POST</code>操作时才会用到下面的entity body。<br>
<span alt="Pasted image 20240605003249.png" src="Pasted image 20240605003249.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240605003249.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240605003249.png"></span></li>
</ol>
</li>
</ul></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="HTTP Response Message" dir="auto" class="heading" id="HTTP_Response_Message"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTP Response Message</h5><div class="heading-children"><div class="el-p"><p dir="auto">下面我们给出一个简单的HTTP响应报文。</p></div><div class="el-pre"><pre><code data-line="0">HTTP/1.1 200 OK 
Connection: close 
Date: Tue, 18 Aug 2015 15:44:04 GMT 
Server: Apache/2.2.3 (CentOS) 
Last-Modified: Tue, 18 Aug 2015 15:11:03 GMT 
Content-Length: 6821 
Content-Type: text/html 
(data data data data data ...)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>从响应报文的格式来看，我们不难看出它是对请求报文的响应，包含一个<strong>状态行(Status line)</strong> 、六个<strong>头部行(Header line)</strong> 和<strong>响应实体(Entity body)</strong>。
<ol>
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>状态行</strong>包括三个字段：HTTP版本字段、<strong>状态码</strong>（请求成功或失败的状态）和原因短语（提供状态码的附加信息）。
<ul>
<li data-line="2" dir="auto">在这个例子中，<code>HTTP/1.1 200 OK </code>表示协议版本是HTTP/1.1，并且everything is OK。</li>
<li data-line="3" dir="auto">常见的状态码和原因短语有：<br>
（1）<mark>200 OK</mark>: Request succeeded and the information is returned in the response.<br>
（2）<mark>301 Moved Permanently</mark>: Requested object has been permanently moved; the new URL is specified in Location: header of the response message. The client software will automatically retrieve the new URL.<br>
（3）<mark>400 Bad Request</mark>: This is a generic error code indicating that the request could not be understood by the server.<br>
（4）<mark>404 Not Found</mark>: The requested document does not exist on this server.<br>
（5）<mark>505 HTTP Version Not Supported</mark>: The requested HTTP protocol version is not supported by the server.</li>
</ul>
</li>
<li data-line="9" dir="auto">之后的六行都是<strong>头部行</strong>。<br>
- 头部行<code>Connection: close </code>告诉客户机进程在发送完报文后就要关闭TCP连接了。<br>
- <code>Date:</code>头部行表示了服务器响应并发出对象报文的时间。<br>
- <code>Server:</code>头部行类似于<code>User-agent</code>头部行，指出报文是被<code>Apache/2.2.3 (CentOS) </code>所发出。<br>
- <code>Last-Modified:</code>头部行表示源服务器认为资源最近一次被修改的日期。<br>
- <code>Content-Length:</code>头部行声明了对象的大小，单位为byte。<br>
- <code>Content-Type:</code>头部行声明了对象的格式，在本例中是html格式的文本。<br>
<span alt="Pasted image 20240605012506.png" src="Pasted image 20240605012506.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240605012506.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240605012506.png"></span></li>
</ol>
</li>
</ul></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.2.4 User-Server Interation: Cookies" dir="auto" class="heading" id="2.2.4_User-Server_Interation:_Cookies"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.4 User-Server Interation: Cookies</h3><div class="heading-children"><div class="el-p"><p dir="auto">我们前文提到，HTTP协议提供的是一个无状态的服务，这简化了服务器设计，提高了服务器的性能。然而由于user identification的需求，HTTP使用<strong>Cookies</strong>使网站能够保存用户的轨迹，以便提供面向用户的内容。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">下图中，我们可以看到cookie由4部分组成（假设之前访问过ebay）：<br>
(1) a cookie header line in the HTTP response message;<br>
(2) a cookie header line in the HTTP request message;<br>
(3) a cookie file kept on the user’s end system and managed by the user’s browser;<br>
(4) a back-end database at the Web site.<br>
<span alt="Pasted image 20240605013943.png" src="Pasted image 20240605013943.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240605013943.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240605013943.png"></span></li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.2.5 Web Caching" dir="auto" class="heading" id="2.2.5_Web_Caching"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.5 Web Caching</h3><div class="heading-children"><div class="el-p"><p dir="auto"><strong>Web cache</strong>—也叫<mark><strong>代理服务器(proxy server)</strong></mark>，是一种代表源Web服务器为HTTP请求提供服务。下图中演示了一个代理服务器的工作方式，当用户浏览器发送HTTP请求报文时，会先在Web cache中寻找是否存有请求对象，因此Web cache需要拥有自己的磁盘存储来拷贝保存最近被请求的对象。<br>
<span alt="Pasted image 20240605160542.png" src="Pasted image 20240605160542.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240605160542.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240605160542.png"></span></p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>假如我们现在需要请求对象<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3A"></mjx-c></mjx-mo><mjx-texatom space="4" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D454 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D453 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span>。则会有以下步骤：
<ol>
<li data-line="1" dir="auto">浏览器先建立与Web cache的TCP连接并向Web cache发送对象的HTTP请求报文。</li>
<li data-line="2" dir="auto">Web cache检查本地是否存储该对象，如果有，则将对象包含在HTTP响应报文的实体空间(entity body)中返回给浏览器。</li>
<li data-line="3" dir="auto">如果Web cache本地不存有该对象信息，Web cache就会和地址是<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span>的源服务器建立一个TCP连接。随后Web cache会在cache-server的TCP连接上向源服务器发送HTTP请求报文，然后源服务器将目标对象包含在响应报文中发送给Web cache。</li>
<li data-line="4" dir="auto">当Web cache收到对象后，它会将对象拷贝放在本地，然后将拷贝的对象包含在响应报文中发送给client浏览器进程。<br>
在这里我们可以发现，Web cache实际上同时充当了client和server的身份。有了Web cache，（1）client请求的响应时间会减少；（2）cache的存在减少了institution访问Internet的拥塞。<br>
一般而言，Web cache受ISP所管理。</li>
</ol>
</li>
<li data-line="7" dir="auto">为了更深入地理解cache的工作原理，我们用下图的例子来解释。我们看到一个LAN-Institutional network还有WAN——Public Internet。其中LAN内部的网络带宽达到了100Mbps而LAN接入WAN的链路只有15Mbps的带宽。<br>
<span alt="Pasted image 20240605164341.png" src="Pasted image 20240605164341.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240605164341.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240605164341.png"></span></li>
<li data-line="9" dir="auto">假设每秒传输15个大小1Mbps的对象，忽略请求报文的大小，则有LAN上的网络拥塞度(traffic intensity)为：<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D440 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D440 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-math></mjx-container></span>而接入WAN链路的网络拥塞度为：<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D440 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D440 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math></mjx-container></span>我们之前就了解过，当网络拥塞度达到接近1时，链路上的延时会达到分钟级别，这是无法被机构用户所接受的。一种解决办法是将公网接入链路的带宽增加到100Mbps，这样的总相应时间大约2s。另一种就是加入cache，将用户常访问的objects存储到本地，这样用户的请求就不必再占用公网的带宽了。</li>
<li data-line="10" dir="auto">假设Web cache的hit rate是0.4（即40%的请求都能通过cache得到满足），则平均时延就成了：<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2248"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span>而且减少了接入链路带宽的占用率，而且获得了比第一种解决方案更小的response time。</li>
<li data-line="11" dir="auto">即便<strong>Content Distribution Networks(CDNs)</strong> 得到了广泛的应用，但是Web cache仍然发挥着不可或缺的作用。它们的关系就如同main memory和cache memory的关系一样。</li>
</ul></div><div class="el-h5 heading-wrapper"><h5 data-heading="The Conditional GET" dir="auto" class="heading" id="The_Conditional_GET"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>The Conditional GET</h5><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">尽管caching的方法有效的降低了响应时间，但也带来了新的问题——处在cache中的信息可能是过时的。因此，HTTP提供一种允许cache检查数据是否是”fresh“的机制叫做<strong>conditional GET</strong>。如果HTTP 请求报文（1）使用GET方法；并且（2）包含<code>If-Modified-Since:</code>头部行。则称这样的HTTP请求报文为<strong>conditional GET message</strong>。</li>
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>现在，我们用一个例子来了解一下conditional GET是如何影响报文传输的吧：
<ol>
<li data-line="2" dir="auto">首先，proxy server向Web server发送一个请求报文	```</li>
</ol>
<pre><code data-line="3">GET /fruit/kiwi.gif HTTP/1.1 
Host: www.exotiquecuisine.com
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre>
<ol start="2">
<li data-line="7" dir="auto">然后cache收到来自Web server的响应报文</li>
</ol>
<pre><code data-line="8">HTTP/1.1 200 OK 
Date: Sat, 3 Oct 2015 15:39:29 
Server: Apache/1.3.0 (Unix) 
Last-Modified: Wed, 9 Sep 2015 09:23:24 
Content-Type: image/gif 
(data data data data data ...)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre>
<ol start="3">
<li data-line="16" dir="auto">之后cache转发响应报文给client browser，并在本地缓存对象文件。其中，cache也会将Last-Modified日期存在本地，在之后收到来自client browser的对象请求时，proxy server可以通过conditional GET来检查本地的object是否是过时的</li>
</ol>
<pre><code data-line="17">GET /fruit/kiwi.gif HTTP/1.1 
Host: www.exotiquecuisine.com 
If-modified-since: Wed, 9 Sep 2015 09:23:24
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre>
<ol start="4">
<li data-line="22" dir="auto">第四步，proxy cache收到源服务器的响应报文。304 Not Modified表示object并没有修改过，因此entity body 不需要放任何数据。也使得proxy server可能放心地去转发之前拷贝的object。</li>
</ol>
<pre><code data-line="23">HTTP/1.1 304 Not Modified 
Date: Sat, 10 Oct 2015 15:39:29 
Server: Apache/1.3.0 (Unix) 
(empty entity body)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre>
</li>
</ul></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.2.6 HTTP/2" dir="auto" class="heading" id="2.2.6_HTTP/2"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.6 HTTP/2</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">制定于2015年的HTTP/2是千禧年后新一版的HTTP协议，之前是在1997年制定的HTTP/1.1。HTTP/2旨在通过单个TCP连接上的请求和响应多路复用来减少感知延迟，提供请求优先级和服务器推送功能，并有效压缩HTTP头字段。HTTP/2不改变HTTP方法、状态码、URL或头字段，而是改变数据在客户端和服务器之间的格式和传输方式。</li>
<li data-line="1" dir="auto">前面我们提到过，持久的TCP连接允许通过单个TCP连接从网页获取多个对象，但这可能会导致<strong>Head of Line(HOL)</strong> 问题，例如一个网页中有一个base HTML文本、一个长视频和视频后的一些小对象，这会导致这些小对象会一直等待长视频传输完成后才开始传输。HTTP/1.1对此的解决方法是打开多个并行的TCP连接，但这可能会导致网络的拥塞。</li>
<li data-line="2" dir="auto">HTTP/2的主要目标之一是减少用于传输单个网页的并行TCP连接数量。这不仅减少了服务器需要打开和维护的套接字数量，还允许TCP拥塞控制按预期运行。但是，由于只有一个TCP连接来传输网页，HTTP/2需要精心设计的机制来避免HOL阻塞。</li>
</ul></div><div class="el-h5 heading-wrapper"><h5 data-heading="HTTP/2 Framing" dir="auto" class="heading" id="HTTP/2_Framing"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTP/2 Framing</h5><div class="heading-children"><div class="el-p"><p dir="auto">HTTP/2对于HOL的解决方案是将报文”打碎“为多个<strong>帧(frame)</strong>，然后多个对象轮番发送，按一定顺序发送第一帧接着第二帧等。这样能够极大的缩短用户的感知延迟。将HTTP报文成帧并在在client端重组报文是HTTP/2最大的改进之一。头部字段划分成一个帧，entity body被划分成一个或多个帧。</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Responce Message Prioritization and Server Pushing" dir="auto" class="heading" id="Responce_Message_Prioritization_and_Server_Pushing"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Responce Message Prioritization and Server Pushing</h5><div class="heading-children"><div class="el-p"><p dir="auto">在client向server发送多个请求时，它可以在权重1-256之间设置请求报文的响应优先级。数字越大表示优先级越高。<br>
HTTP/2还有能力向一个client的一个请求发送多个响应报文，在发送完源请求对应的响应报文后server将额外的对象<strong><em>push</em></strong>给client。</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="HTTP/3" dir="auto" class="heading" id="HTTP/3"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTP/3</h5><div class="heading-children"></div></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="2.25 File Tranfer Protocol\*" dir="auto" class="heading" id="2.25_File_Tranfer_Protocol\*"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.25 File Tranfer Protocol*</h2><div class="heading-children"><div class="el-h5 heading-wrapper"><h5 data-heading="FTP: 文件传输协议" dir="auto" class="heading" id="FTP:_文件传输协议"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>FTP: 文件传输协议</h5><div class="heading-children"><div class="el-p"><p dir="auto">□ 向用户主机上传输文件或从远程主机上接收文件<br>
□ 客户机/服务器模式</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">客户端：发起传输的一方</li>
<li data-line="1" dir="auto">服务器：远程主机<br>
□ ftp：[RFC 959]<br>
□ ftp服务器：端口号为21</li>
</ul></div><div class="el-p"><p dir="auto">在TCP/IP协议中， 需要两个端口，一个是数据端口，一个是控制端口。</p></div><div class="el-p"><p dir="auto">控制端口一般为21，而数据端口不一定是20，这和FTP的应用模式有关，如果是主动模式，应该为20，如果为被动模式，由服务器端和客户端协商而定。相比于HTTP，FTP协议要复杂得多。复杂的原因，是因为FTP协议要用到两个TCP连接，一个是命令链路，用来在FTP客户端与服务器之间传递命令；另一个是数据链路，用来上传或下载数据。</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="FTP: 控制连接与数据连接分开" dir="auto" class="heading" id="FTP:_控制连接与数据连接分开"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>FTP: 控制连接与数据连接分开</h5><div class="heading-children"><div class="el-p"><p dir="auto">□ FTP客户端与FTP服务器通过端口21联系，使用TCP作为传输协议<br>
□ 客户端通过控制连接获得身份确认<br>
□ 客户端通过控制连接发送命令浏览远程目录<br>
□ 收到一个问价传输命令时，服务器打开一个到客户端的数据连接<br>
□ 一个文件传输完成后，服务器关闭连接<br>
□ 服务器打开第二个TCP数据连接用来传输另一个文件</p></div><div class="el-p"><p dir="auto">□ 控制连接：带外（out of band）传送<br>
□ FTP服务器维护用户的状态信息：当前路径、用户账户与控制连接对应<br>
（即FTP服务器维护client的状态）</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="FTP命令、响应" dir="auto" class="heading" id="FTP命令、响应"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>FTP命令、响应</h5><div class="heading-children"><div class="el-p"><p dir="auto">□ FTP 在控制连接上，信息以ASCII文本的方式传送</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>命令样例</strong>：
<ul>
<li data-line="1" dir="auto"><code>USER username</code></li>
<li data-line="2" dir="auto"><code>PASS password</code></li>
<li data-line="3" dir="auto"><code>LIST</code>：请服务器返回远程主机当前目录检索文件（gets）</li>
<li data-line="4" dir="auto"><code>STOR filename</code>：向远程主机的当前目录存放文件（puts）</li>
</ul>
</li>
<li data-line="5" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>返回码样例</strong>：
<ul>
<li data-line="6" dir="auto">状态码与状态信息（同HTTP）</li>
<li data-line="7" dir="auto"><code>331 Username OK,</code><br>
<code>password required</code></li>
<li data-line="9" dir="auto"><code>125 data connection already open;</code><br>
<code>transfer starting</code></li>
<li data-line="11" dir="auto"><code>425 Can't open data connection</code></li>
<li data-line="12" dir="auto"><code>452 Error writing file</code></li>
</ul>
</li>
</ul></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="2.3 Electronic Mail in the Internet" dir="auto" class="heading" id="2.3_Electronic_Mail_in_the_Internet"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.3 Electronic Mail in the Internet</h2><div class="heading-children"><div class="el-p"><p dir="auto"><em>Electronic mail has been around since the beginning of the Internet. It was the most popular application when the Internet was in its infancy.</em></p></div><div class="el-p"><p dir="auto">在本节，我们将介绍Internet e-mail中最核心的应用层协议<strong>SMTP(Simple Mail Transfer Protocol)</strong> 。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>从下图我们可以看到，Internet邮件系统由三部分构成：<strong>user agents</strong>、<strong>mail servers</strong>还有<strong>SMTP</strong>。<br>
<span alt="Pasted image 20240605212341.png" src="Pasted image 20240605212341.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240605212341.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240605212341.png"></span>
<ul>
<li data-line="2" dir="auto">E-mail中一些有名的user agent包括Microsoft Outlook、Web-based Gmail、Gmail App 等。</li>
<li data-line="3" dir="auto">Mail server是e-mail infrastructure中的核心。每个收件人都会有一个唯一某个mail server中的<strong>mailbox</strong>。在e-mail 系统中，报文由发送人的user agent发出，经由发件人的mail server送到收件人的mail server中，等待收件人查看邮箱中的内容。不仅如此，mail server 也会对收件人mail server中传输的失败情况作出反应。发件人的server会将报文放在<strong>message queue</strong>中，如果没有收到收件server的收到反馈，发件server就会每隔一段时间发送邮件。如果很长时间仍没有反馈，则用一则email通知发件人。</li>
<li data-line="4" dir="auto">SMTP使用可靠的TCP传输协议来传送信件。和大多数应用层协议一样，SMTP有两个端构成—client side和server side。</li>
</ul>
</li>
</ul></div><div class="el-h3 heading-wrapper"><h3 data-heading="SMTP" dir="auto" class="heading" id="SMTP"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>SMTP</h3><div class="heading-children"><div class="el-p"><p dir="auto">SMTP(Simlple mail trasfer protocol)是互联网最早出现的应用层协议之一（它出现于1982年，比HTTP还早）。由于它出现的时间很早，考虑的事情不完全，也因此，它在当今是一种legacy technology。例如：SMTP规定在发送E-mail报文时要先将报文的body部分编码成7-bits ASCII，7位的ASCII显然不适用于现代多媒体信息的传送，只适用文本的传输，也体现了其过时的性质。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>我们通过下面的例子简单看看SMTP是怎么工作的：
<ol>
<li data-line="1" dir="auto">Alice给她的user agent提供Bob的邮箱地址（如<code>bob@someschool.edu</code>）和信件并操作user agent发送报文。</li>
<li data-line="2" dir="auto">User agent将报文发送给Alice的mail server处，mail server会将这些e-mail排队依次发出。</li>
<li data-line="3" dir="auto">Alice的mail server通过TCP与另一台mail server连接。</li>
<li data-line="4" dir="auto">在SMTP握手初始化完成后，SMTP client side通过TCP连接发送Alice的mail。</li>
<li data-line="5" dir="auto">Bob的mail server收到信件后将信件放在Bob的mailbox中。</li>
<li data-line="6" dir="auto">Bob随时查看。<br>
<span alt="Pasted image 20240608041543.png" src="Pasted image 20240608041543.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240608041543.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240608041543.png"></span></li>
</ol>
</li>
<li data-line="8" dir="auto">现在我们来看看其中的更多细节：在client SMTP发送mail时，它会先和server SMTP的<mark><strong>25号端口</strong></mark>建立TCP连接。如果server下线，client之后会重新请求连接。一旦连接建立，client就会和server初始化SMTP应用层的握手。在这个阶段，SMTP client和server会互相发送email地址。这个过程完成后，client就可以发送报文了，SMTP可以提供报文传输的可靠性。client继续传输其他报文，如果报文没有了，client就会关闭TCP连接。 </li>
<li data-line="9" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>下面我们看看SMTP会话的例子：
<pre><code data-line="10">S:&nbsp;&nbsp;220 hamburger.edu 
C:&nbsp;&nbsp;HELO crepes.fr
S:&nbsp;&nbsp;250 Hello crepes.fr, pleased to meet you 
C:&nbsp;&nbsp;MAIL FROM: &lt;alice@crepes.fr&gt;
S:&nbsp;&nbsp;250 alice@crepes.fr ... Sender ok 
C:&nbsp;&nbsp;RCPT TO: &lt;bob@hanburger.edu&gt;
S:&nbsp;&nbsp;250 bob@hamburger.edu ... Recipient ok 
C:&nbsp;&nbsp;DATA 
S:&nbsp;&nbsp;354 Enter mail, end with ”.” on a line by itself 
C:&nbsp;&nbsp;Do you like ketchup? 
C:&nbsp;&nbsp;How about pickles? 
C:&nbsp;&nbsp;. 
S:&nbsp;&nbsp;250 Message accepted for delivery 
C:&nbsp;&nbsp;QUIT 
S:&nbsp;&nbsp;221 hamburger.edu closing connection
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre>
<ul>
<li data-line="27" dir="auto">我们可以看到这里client发送的命令<code>HELO</code>、<code>MAIL FROM</code>、<code>RCPT TO</code>、<code>DATA</code>、<code>QUIT</code>。这些自解释性的命令我们很容易看明白。与HTTP一样，SMTP报文的每一行也是由CRLF结尾的(Carriage Return and Line Feed)。<mark>SMTP提供持久性的连接</mark>，因此，在我们没有发起QUIT请求前，我们可以一直用DATA命令向server发送多个email。</li>
<li data-line="28" dir="auto">我们可以通过<code>telnet</code>命令来直接与server建立直接的会话，像这样：<br>
<code>telnet servername 25</code><br>
这样就在本地主机和邮件服务器之间建立一个TCP连接。之后，我们应当收到服务器的220回复。<br>
连接成功后，我们就可以发送SMTP命令了：</li>
</ul>
<pre><code data-line="32">HELO yourDomain.com
MAIL FROM: &lt;yourEmail@yourDomain.com&gt;
RCPT TO:&lt;recipientEmail@recipientDomain.com&gt;
DATA
Subject: Test Email
This is a test email sent from Telnet.
.
QUIT
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre>
</li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.3.2 Mail Message Formats" dir="auto" class="heading" id="2.3.2_Mail_Message_Formats"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.3.2 Mail Message Formats</h3><div class="heading-children"><div class="el-p"><p dir="auto">在向别人写信时，我们一般会在信纸上写上“给某某”和“爱你的某某”。SMTP中mail message的格式也一样，<mark>在真正写信之前，必须先写上头部行</mark>。每个message头都必须包含<code>From:</code>头部行和<code>To:</code>头部行，<code>Subject</code>头部行时可以舍去的。<br>
SMTP的massage header可能是这样的：</p></div><div class="el-pre"><pre><code data-line="0">From: alice@crepes.fr 
To: bob@hamburger.edu 
Subject: Searching for the meaning of life.
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.3.3 Mail Access Protocols" dir="auto" class="heading" id="2.3.3_Mail_Access_Protocols"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.3.3 Mail Access Protocols</h3><div class="heading-children"><div class="el-p"><p dir="auto">通过之前对SMTP的学习，我们可能会有mail server存在意义何在的疑问。确实，信件总是先被传送到mail server后再转发给用户，总会有让用户有信息安全方面的担忧。但是，让用户时时刻刻保持在线连网的状态对很多人而言是不现实的。因此，我们在发电邮时会先将email发到一个<mark>always-on shared mail server</mark>中。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>我们接着了解一下email message的传输路径吧！实际上，email是可以直接由发信人的agent之间发送到收信人的mail server中的。但一般我们不这样做，如下图：<br>
<span alt="Pasted image 20240609005629.png" src="Pasted image 20240609005629.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240609005629.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240609005629.png"></span>
<ul>
<li data-line="2" dir="auto">至此，我们仍有一个疑问——收件人(recipient)Bob是如何收到给他的message的？我们学习了SMTP，但是SMTP只是发信的协议(push protocol)。</li>
<li data-line="3" dir="auto">当今，我们主要有两种方式来将mail server中的信件转发给user agent——<strong>HTTP</strong>和<strong>Internet Mail Access Protocol(IMAP)</strong>。前者一般用于Web-based email或手机应用（如Gmail），后者用在mail clients（如Outlook）。</li>
</ul>
</li>
</ul></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="2.4 DNS-The Internet's Directory Service" dir="auto" class="heading" id="2.4_DNS-The_Internet's_Directory_Service"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.4 DNS-The Internet's Directory Service</h2><div class="heading-children"><div class="el-p"><p dir="auto"><em>Just as humans can be identified in many ways, so too can Internet hosts.</em></p></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.4.1 Services Provided by DNS" dir="auto" class="heading" id="2.4.1_Services_Provided_by_DNS"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.4.1 Services Provided by DNS</h3><div class="heading-children"><div class="el-p"><p dir="auto">在Internet中，有两种方式来识别一个主机：（1）通过<strong>hostname</strong>；（2）通过<strong>IP地址</strong>；可以理解为human name和human ID number。人们当然更喜欢便于记忆的hostname，但是router路由时当然喜欢定长结构化的IP地址进行路由。这也就是<strong>DNS</strong>的主要工作。</p></div><div class="el-p"><p dir="auto">在Internet中，<strong>DNS</strong>是（1）不同层次的<strong>DNS服务器</strong>组成的<strong>分布式数据库</strong>；（2）允许hosts查询分布式数据库的的<strong>应用层协议</strong>。</p></div><div class="el-p"><p dir="auto">通常情况下，DNS运行在BIND(Berkeley Internet Name Domain)软件上，DNS一般采用UDP传输层协议，使用<strong>53号端口</strong>。</p></div><div class="el-p"><p dir="auto">DNS作为一个工具，常常被同为应用层的协议如：HTTP、SMTP所使用。下面举例简单说明一下DNS是怎么工作的。<br>
假设browser要请求URL <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span>中的内容，在发送请求报文前：</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">client host在<strong>53号端口</strong>运行DNS client应用；</li>
<li data-line="1" dir="auto">browser从URL中拽出hostname，<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D464 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c210E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span>，将其送给DNS应用；</li>
<li data-line="2" dir="auto">DNS 客户端向 DNS 服务器<strong>发送包含主机名的查询</strong>；</li>
<li data-line="3" dir="auto">DNS 客户端从 DNS 服务器<strong>收到包含IP地址的回复</strong>；</li>
<li data-line="4" dir="auto">一旦browser从 DNS 收到IP地址，他就会初始化与HTTP服务进程<strong>80号端口</strong>的TCP连接。</li>
</ol></div><div class="el-p"><p dir="auto">我们从上面例子中看到，DNS提供IP地址解析的服务为应用添加了额外的时延。但和Proxy Server会缓存HTTP报文一样，结构化的DNS服务器也同样会将DNS的相关数据cache到临近client host的DNS server。<br>
从此我们可以看到，DNS提供的服务不仅仅只是IP地址和hostname之间的转换。还有：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><strong>Host aliasing</strong>：主机别名。一个主机可以有<strong>一个规范主机名(Canonical hostname)</strong> 和 <strong>多个别名(Alias hostname)</strong>，DNS可以将这些别名映射到同一个IP地址。</li>
<li data-line="1" dir="auto"><strong>Mail server aliasing</strong>：邮件服务器别名。为方便记忆，e-mail地址也可以拥有别名。如Bob有一个yahoo的邮箱地址是<code>bob@yahoo.com</code>。我们看到的yahoo的邮件服务器主机名是简单的<code>yahoo.com</code>，但它的规范主机名可能会是<code>relay1.west-coast.yahoo.com</code>。显然，<code>yahoo.com</code>更容易记忆。</li>
<li data-line="2" dir="auto"><strong>Load distribution</strong>：负载分配。对于一些大型公司，它们可能会将Web服务器分布的放在各个地方同时为用户提供服务。这些服务器有不同的IP地址，但使用相同的hostname。DNS数据库中会将这些地址与同一hostname关联起来。DNS会决定使用哪个服务器去响应用户的Web请求。</li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.4.2 Overview of How DNS Works" dir="auto" class="heading" id="2.4.2_Overview_of_How_DNS_Works"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.4.2 Overview of How DNS Works</h3><div class="heading-children"><div class="el-p"><p dir="auto">我们已经概况的了解了DNS提供服务的，本节我们来看看DNS所提供的 <strong>主机名-IP地址</strong> 映射服务。假设某些应用需要用到这样的服务，他会先将需要转换的信息给客户端的DNS，然后DNS完成转换工作。</p></div><div class="el-p"><p dir="auto">在很多UNIX-based的机器上，系统会提供<code>gethostbyname()</code>函数封装转换服务。随后用户机上的DNS会接管，向网络送出query message。所有的DNS问询和其收到的回复报文都会被<strong>53号端口</strong>通过<strong>UDP数据报</strong>的方式传输。经过一段时间的时延后DNS收到映射后的内容。之后，这段内容会被传给应用。应用所看到的只是一个黑盒子，将主机名（IP地址）丢进去，黑盒会返回应用想要的IP地址（主机名）。但事实上，这”个“黑盒子涵括了分布在全球成千上万的<strong>DNS服务器</strong>和指定这些服务器通讯的<strong>应用层协议</strong>。</p></div><div class="el-p"><p dir="auto">对于DNS，最简单的设计思想可能就是中心化的设计了！即让一个DNS服务器记录所有的主机名-IP地址映射关系。但我们也很容易发现其中的弊端：<br>
- <strong>A single point of failure</strong><br>
- <strong>Traffic volume</strong><br>
- <strong>Distant certralized database</strong><br>
- <strong>Maintenance</strong><br>
而DNS数据库设计是分布式的、层次化的。但中心化的单一DNS服务器<em>just doesn't scale</em>。</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="A Disruibuted, Hierarchical Database" dir="auto" class="heading" id="A_Disruibuted,_Hierarchical_Database"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>A Disruibuted, Hierarchical Database</h5><div class="heading-children"><div class="el-p"><p dir="auto">DNS是一个浩大的工程，分布式、层次化的DNS服务器遍布世界各地。得益于这种扩展性(scale)，没有一个DNS服务器需要记录全部的 主机名-IP地址 映射关系，主机名-IP地址的映射分布交叉地存放在各个DNS服务器中。</p></div><div class="el-p"><p dir="auto">我们用下图来近似地描述这种分布式、层次化的关系，我们可以看到三类DNS服务器：<strong>root DNS 服务器</strong>、<strong>top-level domain(TLD) DNS服务器</strong> 和 <strong>authoritative DNS服务器</strong>。<br>
<span alt="Pasted image 20240612014451.png" src="Pasted image 20240612014451.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240612014451.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240612014451.png"></span></p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">
<p><strong>根DNS服务器</strong>：世界上有13个IPv4的根服务器，为12个组织所管理，但是为了保证根域名服务器的可用性，会部署多个节点。因此也有说全球根服务器的数量在1000+左右（截至2020）。<em>根域名服务器能够<strong>提供 TLD服务器的 IP地址</strong>。</em></p>
</li>
<li data-line="2" dir="auto">
<p><strong>顶级域服务器</strong>：TDL服务器管理并提供特定TLD的DNS服务。这些顶级域名有：<code>com</code>、<code>org</code>、<code>net</code>、<code>edu</code>、<code>gov</code>，还有国家TLD如：<code>uk</code>、<code>cn</code>、<code>jp</code>等。顶级域名由不同的公司或组织所拥有和管理，如Educause管理<code>edu</code> TLD。TLD服务器<strong>提供权威DNS服务器的IP地址。</strong></p>
</li>
<li data-line="4" dir="auto">
<p><strong>权威DNS服务器</strong>：权威DNS服务器记录存储特定域名的官方DNS，<strong>记录主机名和IP地址之间的映射关系</strong>。任何提供公开访问主机的组织都需要应用权威DNS服务器。对于这些组织来说，它们可以自己搭建服务器或交给特定的服务提供商。大多数的大学和大型公司都有自己的一级和二级权威DNS服务器（备份）。</p>
</li>
</ul></div><div class="el-p"><p dir="auto">从DNS服务器层次结构中我们看到root、TLD还有authoritative DNS服务器。但在DNS服务器层次结构外还有一种十分重要的DNS服务器，叫做<strong>local DNS server</strong>。尽管严格来说local DNS server并不属于architecture，但却处在architecture的C位。<mark>每个ISP都会有这样的local DNS server</mark>(也叫default name server)。下面我们演示local DNS server是怎么工作的（假设主机<code>cse.nyu.edu</code>想要获得主机<code>gaia.cs.umass.edu</code>的IP地址）：</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">主机<code>cse.nyu.edu</code>向local DNS server发送解析<code>gaia.cs.umass.edu</code>的查询报文；（query）</li>
<li data-line="1" dir="auto">Local DNS 服务器向 Root DNS 服务器转发查询报文；（query）</li>
<li data-line="2" dir="auto">Root DNS 服务器根据顶级域名<code>edu</code>返回负责该顶级域名TLD服务器的IP地址列；（reply）</li>
<li data-line="3" dir="auto">Local DNS 服务器向其中一个 TLD DNS 服务器发送请求报文；（query）</li>
<li data-line="4" dir="auto">TLD DNS 服务器根据<code>umass.edu</code>后缀返回authoritative DNS 服务器的IP地址；（reply）</li>
<li data-line="5" dir="auto">Local DNS 服务器直接向主机<code>dns.umass.edu</code>发生请求报文；（query）</li>
<li data-line="6" dir="auto">Authoritative DNS 服务器返回<code>gaia.cs.umass.edu</code>的IP地址；（reply）</li>
<li data-line="7" dir="auto">Local DNS 服务器将IP地址转发给主机<code>cse.nyu.edu</code>。（reply）<br>
在整个过程中，为了获得目标之际的IP地址映射，一共发送了8个DNS报文：四个query messages和四个reply messages。之后，我们会了解到DNS caching是怎么优化DNS查询过程的。<br>
<span alt="Pasted image 20240618164507.png" src="Pasted image 20240618164507.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240618164507.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240618164507.png"></span></li>
</ol></div><div class="el-p"><p dir="auto">之前，我们假设TDL 服务器默认知道目标hostname在哪个authoritative DNS 服务器的情况，但现实中不全是这样的。可能的情况是，TLD服务器只认得一些知道authoritative DNS 服务器hostname的intermediate DNS 服务器在哪。这样，local DNS 服务器就需要额外的DNS通讯才能找到最终的authoritative DNS 服务器。（<mark>额外 N个intermediate DNS 服务器产生额外 2N个DNS messages</mark>）<br>
<strong>Recurive queries and iterative queries</strong><br>
The example shown in Figure 2.19 makes use of both <strong>recursive queries</strong> and <strong>iterative queries</strong>. The query sent from <code>cse.nyu.edu</code> to <code>dns.nyu.edu</code> is a recursive query, since the query asks <code>dns.nyu.edu</code> to obtain the mapping on its behalf. However, the subsequent three queries are iterative since all of the replies are directly returned to <code>dns.nyu.edu</code>. In theory, any DNS query can be iterative or recursive. For example, Figure 2.20 shows a DNS query chain for which all of the queries are recursive. In practice, the queries typically follow the pattern in Figure 2.19: The query from the requesting host to the local DNS server is recursive, and the remaining queries are iterative</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="DNS Caching" dir="auto" class="heading" id="DNS_Caching"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>DNS Caching</h5><div class="heading-children"><div class="el-p"><p dir="auto">在上面的例子中，我们看到，请求DNS服务的client向知道目标主机 hostname/IP 映射关系的authoritative server请求DNS服务时，DNS messages的数量会随着intermediate DNS 服务器结点的增加而增加：<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D454 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math></mjx-container></span>而使用caching的方式时，当cache命中，DNS消息的数量将锐减到：<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi><mjx-mtext class="mjx-n"><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D454 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math></mjx-container></span>从中，我们能够看到在服务器结点之间加入一个cache是多么重要。</p></div><div class="el-p"><p dir="auto">DNS caching的思想十分简单，和HTTP中的proxy server(Web cache)的思想类似，都是通过保存近期请求的数据来减少未来请求的处理时间和网络流量。这种缓存机制在提高DNS解析速度和减少网络拥塞方面起着至关重要的作用。</p></div><div class="el-p"><p dir="auto">在下面的例子中，在Requesting host首次请求查询<code>gaia.cs.umass.edu</code>的 IP 时，local DNS 服务器会将主机<code>gaia.cs.umass.edu</code>的 hostname/IP 映射关系缓存到本地。如果另一台主机也有查询<code>gaia.cs.umass.edu</code>的 IP 的话，local DNS server会直接将缓存在本地的 IP 地址转发给requesting host，即只需要2步。<br>
<span alt="Pasted image 20240618185617.png" src="Pasted image 20240618185617.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240618185617.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240618185617.png"></span></p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.4.3 DNS Records and Messages" dir="auto" class="heading" id="2.4.3_DNS_Records_and_Messages"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.4.3 DNS Records and Messages</h3><div class="heading-children"><div class="el-p"><p dir="auto">DNS 服务器共同组成了存放<strong>Resource Records(RRs)</strong> 的DNS 分布式数据库。<mark>每个DNS reply message 都包含着至少一个的<strong>资源记录(RRs)</strong></mark>。</p></div><div class="el-p"><p dir="auto">RRs是一个包含以下字段(fields)四元组(four-tuple)：<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D449 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D447 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c1D447 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D447 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D43F TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math></mjx-container></span>这个四元组中，前三个字段我们望文生义，最后一个英文缩写 TTL(Time To Live) 表示这个RR在DNS caching 中剩余的存放时间（当RR长时间没有被访问时，RR就会从DNS caching中被清除出去）。</p></div><div class="el-p"><p dir="auto">下面，我们看看 RRs 的其余三个字段的含义。其中，字段<code>Name</code>和字段<code>Value</code>的含义取决于<code>Type</code>字段：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">如果<code>Type=A</code>，这时，<strong><code>Name</code>就是一个主机名</strong> 并且 <strong><code>Value</code>是主机的 IP 地址</strong>。因而，Type A 记录提供 标准的 hostname/IP 映射关系， <mark>(relay1.bar.foo.com, 145.37.93.126, A)</mark> 就是一个Type A的记录。（当<code>Type=AAAA</code>表示正在查询域名的IPv6地址）</li>
<li data-line="1" dir="auto">如果<code>Type=NS</code>，这时，<strong><code>Name</code>就是一个域名(domain)</strong>  并且 <strong><code>Value</code>是知道如何获得域名内主机 IP 地址的authoritative DNS server的主机名</strong>。<mark>(foo.com, dns.foo.com, NS)</mark>就是一个Type NS的记录。这种记录告诉其他DNS服务器如果需要解析<code>foo.com</code>域内的任何主机名，应该查询<code>dns.foo.com</code>这个权威DNS服务器。</li>
<li data-line="2" dir="auto">如果<code>Type=CNAME</code>，那么 <strong><code>Value </code>就是一个规范主机名(canonical hostname)</strong> ，这时的 <strong><code>Name</code>字段用来表示主机别名</strong> 这种记录向querying hosts提供主机的规范主机名。<mark><code>(foo.com, relay1.bar.foo.com, CNAME)</code></mark>就是一种CNAME记录。</li>
<li data-line="3" dir="auto">如果<code>Type=MX</code>，则 <strong><code>Value</code>表示mail server的规范名</strong> 而 <strong><code>Name</code>表示mail server的别名</strong>。<mark><code>(foo.com, relay1.bar.foo.com, CNAME) </code></mark>就是一种 CNAME 记录。<br>
Noter：<br>
MX records allow the hostnames of mail servers to have simple aliases. By using the MX record, a company can have the same aliased name for its mail server and for one of its other servers (such as its Web server). To obtain the canonical name for the mail server, a DNS client would query for an MX record; to obtain the canonical name for the other server, the DNS client would query for the CNAME record</li>
</ul></div><div class="el-p"><p dir="auto">RRs 不同的Type代表着不同的含义，不同服务器中记录的RRs的种类也不尽相同。在authoritative DNS 服务器中，存储的是Type A的RRs；在其他DNS 服务器如TLD服务器中存放着Type为NS的RRs。</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="DNS Messages" dir="auto" class="heading" id="DNS_Messages"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>DNS Messages</h5><div class="heading-children"><div class="el-p"><p dir="auto">在之前的Figure 2.19中，我们知道DNS query messages 和 reply DNS messages 是如何传输的。我们看到两种DNS message，但事实上，不论是query messages 还是 reply messages 都<mark>使用同一DNS报文格式。</mark>DNS报文格式如下：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>头12个字节叫<strong>DNS报头(<em>header section</em>)</strong>。其中又有很多不同作用的字段。
<ul>
<li data-line="1" dir="auto">标识字段（16 bits）：用于标识一次查询/响应过程，由客户端设置，服务器返回相同的值。</li>
<li data-line="2" dir="auto">标志字段：包含多个控制标志，如1 bit query/reply flag（query(0)/reply(1)）、操作码、是否期望递归查询等。</li>
<li data-line="3" dir="auto">问题计数：指示查询请求中问题的数量。</li>
<li data-line="4" dir="auto">回答资源记录数：指示响应中回答的数量。</li>
<li data-line="5" dir="auto">权威名称服务器计数：指示响应中权威名称服务器记录的数量。</li>
<li data-line="6" dir="auto">附加资源记录数：指示响应中附加记录的数量。</li>
</ul>
</li>
<li data-line="7" dir="auto">接下来的DNS报文节叫做<strong>DNS <em>question section</em></strong>。它包括：<br>
(1) 名称字段(<em>Name field</em>)，它表示querying hostname。<br>
(2) 类型字段(<em>Type field</em>)，它表示querying name的种类。</li>
<li data-line="10" dir="auto">然后来自DNS服务器的reply在<strong>DNS <em>answer section</em></strong> 中存放。根据报头和question section的内容，answer section可以返回多个不同的RRs。</li>
<li data-line="11" dir="auto"><strong><em>Authority section</em></strong> 包括了其他权威服务器的记录信息。</li>
<li data-line="12" dir="auto"><strong><em>Additional section</em></strong> 中包含着其他有用的信息，比如用于支持额外功能的记录。<br>
<span alt="Pasted image 20240619182044.png" src="Pasted image 20240619182044.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240619182044.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240619182044.png"></span></li>
</ul></div><div class="el-p"><p dir="auto">举一个DNS querying message的例子：</p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th align="center" dir="ltr">Header</th>
<th align="center" dir="ltr">Questions</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" dir="ltr">Transaction ID: 0x9ad0</td>
<td align="center" dir="ltr">Name: <a data-tooltip-position="top" aria-label="http://www.baidu.com" rel="noopener nofollow" class="external-link" href="http://www.baidu.com" target="_blank">www.baidu.com</a></td>
</tr>
<tr>
<td align="center" dir="ltr">Flags: 0x0100 (Standard query)</td>
<td align="center" dir="ltr">Type: A (Host Address)</td>
</tr>
<tr>
<td align="center" dir="ltr">Questions: 1</td>
<td align="center" dir="ltr">Class: IN (Internet)</td>
</tr>
<tr>
<td align="center" dir="ltr">Answer RRs: 0</td>
<td align="center" dir="auto"></td>
</tr>
<tr>
<td align="center" dir="ltr">Authority RRs: 0</td>
<td align="center" dir="auto"></td>
</tr>
<tr>
<td align="center" dir="ltr">Additional RRs: 0</td>
<td align="center" dir="auto"></td>
</tr>
</tbody>
</table></div><div class="el-p"><p dir="auto">我们现在再看看DNS reply message的例子：</p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th align="center" dir="ltr">Header Sect.</th>
<th align="center" dir="ltr">Questions Sect.</th>
<th align="center" dir="ltr">Answers Sect.</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" dir="ltr">Transaction ID: 0x9ad0</td>
<td align="center" dir="ltr">Name: <a data-tooltip-position="top" aria-label="http://www.baidu.com" rel="noopener nofollow" class="external-link" href="http://www.baidu.com" target="_blank">www.baidu.com</a></td>
<td align="center" dir="ltr">Name: <a data-tooltip-position="top" aria-label="http://www.baidu.com" rel="noopener nofollow" class="external-link" href="http://www.baidu.com" target="_blank">www.baidu.com</a></td>
</tr>
<tr>
<td align="center" dir="ltr">Flags: 0x8180 (Standard query response, No error)</td>
<td align="center" dir="ltr">Type: A (Host Address)</td>
<td align="center" dir="ltr">Type: A (Host Address)</td>
</tr>
<tr>
<td align="center" dir="ltr">Questions: 1</td>
<td align="center" dir="ltr">Class: IN (Internet)</td>
<td align="center" dir="ltr">Class: IN (Internet)</td>
</tr>
<tr>
<td align="center" dir="ltr">Answer RRs: 1</td>
<td align="center" dir="auto"></td>
<td align="center" dir="ltr">TTL: 86400</td>
</tr>
<tr>
<td align="center" dir="ltr">Authority RRs: 0</td>
<td align="center" dir="auto"></td>
<td align="center" dir="ltr">Data length: 4</td>
</tr>
<tr>
<td align="center" dir="ltr">Additional RRs: 0</td>
<td align="center" dir="auto"></td>
<td align="center" dir="ltr">Address: 123.125.114.144</td>
</tr>
</tbody>
</table></div><div class="el-p"><p dir="auto"><strong>nslookup program</strong></p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">当我们想要请求DNS服务时，我们可以使用<code>nslookup</code>来获取域名和IP地址之间的映射。</li>
</ul></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Inserting Records into the DNS Database" dir="auto" class="heading" id="Inserting_Records_into_the_DNS_Database"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Inserting Records into the DNS Database</h5><div class="heading-children"><div class="el-p"><p dir="auto">我们已经了解了如何从DNS distributed database中获取我们想要的信息。但当我们创立一个公司后，我们需要拥有自己的网站来宣传自己的产品。我们应该怎么做呢？（假设我们创立商业公司，也就是TLD为<code>com</code>）</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">首先，我们要在域名注册商(registrar)那里<strong>注册</strong>一个自己的域名。</li>
<li data-line="1" dir="auto">当域名创建之后，你需要向域名注册商<strong>提供</strong>你的主要和次要权威DNS服务器的名称和IP地址。</li>
<li data-line="2" dir="auto">之后，域名注册商会将一个Type NS 和 一个Type A 的记录将你的DNS服务器的hostname/IP mapping关系<strong>加入</strong>到TLD <code>com</code> 的服务器中。</li>
<li data-line="3" dir="auto">然后还需将你的Web server地址以Type A 的资源记录还有你的mail server地址以Type MX 的资源记录的方式在你的权威DNS服务器中<strong>建立</strong> hostname/IP mappings。</li>
</ol></div></div></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="2.5 Peer-to-Peer File Distribution" dir="auto" class="heading" id="2.5_Peer-to-Peer_File_Distribution"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.5 Peer-to-Peer File Distribution</h2><div class="heading-children"><div class="el-p"><p dir="auto">在之前的章节中，我们已经学习过的应用层应用有：Web应用、e-mail和DNS，他们都是基于C/S 体系结构。这些应用对于一个时刻响应的服务器的需求是时时刻刻都存在的。但Peer-to-peer网络体系结构对这样的服务器的依赖是很少的，由于每个终端设备（也叫节点）都可以处理请求且资源分散在各个节点上的，因此每个节点既可以作为客户端，也可以做服务器。</p></div><div class="el-p"><p dir="auto">在本节中，我们将了解当今最流行的P2P file distribution protocol——BitTorrent。我们之前已经了解过，在C/S网络体系结构中，资源只保存在服务器端，资源的传输方向只能是 server-&gt;client。这样，服务器频繁的传输资源会对服务器带来严重的负担。而在P2P网络体系结构中，资源可以分布地存储在各个peer中，<mark>每个peer都可以是资源的请求者，也可以是资源的提供者</mark>。</p></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.5.1 Scalability of P2P Architecture" dir="auto" class="heading" id="2.5.1_Scalability_of_P2P_Architecture"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.5.1 Scalability of P2P Architecture</h3><div class="heading-children"><div class="el-p"><p dir="auto">为了展现P2P体系结构在传输文件上的优越性，我们用下图的例子来演示并计算每种architecture的分发时间。</p></div><div class="el-p"><p dir="auto">我们假设服务器接入链路(access link)的上传速率为 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container></span> ，第 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> 个对等体接入链路的上传速率为 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container></span> 且第 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> 个对等体接入链路的下载速率为 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container></span> 。我们在假设分布在服务器的文件大小是 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> ，<strong>分发时间(distribution time)</strong> 是将文件全部传给 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> 个对等体的时间。<br>
<span alt="Pasted image 20240620183658.png" src="Pasted image 20240620183658.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240620183658.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240620183658.png"></span></p></div><div class="el-h5 heading-wrapper"><h5 data-heading="Distribution Time for Client/Server Architecture" dir="auto" class="heading" id="Distribution_Time_for_Client/Server_Architecture"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Distribution Time for Client/Server Architecture</h5><div class="heading-children"><div class="el-p"><p dir="auto">假设采用C/S体系结构的分发时间是 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D436 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-math></mjx-container></span> 。由于在C/S体系结构下，服务器需要将 File 向每个peer都发送一遍，因此服务器需要传输 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> bits。而我们知道服务器的上传速率是 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container></span>，因而，在理想情况下的分发时间为： <span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D436 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math></mjx-container></span>假设对等体接入链路中最慢的下载速率是 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-math></mjx-container></span> ，同时考虑到着两种情况，那么我们会得到分发时间：<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D436 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2265"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c7B"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mfrac space="2"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n"><mjx-c class="mjx-c7D"></mjx-c></mjx-mo></mjx-math></mjx-container></span>若只考虑服务器的上传和对等体的下载，那么分发时间：<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D436 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c7B"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mfrac space="2"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n"><mjx-c class="mjx-c7D"></mjx-c></mjx-mo></mjx-math></mjx-container></span>在这个等式中我们发现当时间<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mfrac><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mrow size="s"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-msub size="s"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math></mjx-container></span>成为瓶颈时，分发时间会随着 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> 的增加而增加。这还是不考虑网络带宽的情况下。</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Distribution Time for P2P Architecture" dir="auto" class="heading" id="Distribution_Time_for_P2P_Architecture"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Distribution Time for P2P Architecture</h5><div class="heading-children"><div class="el-p"><p dir="auto">当网络采用P2P体系结构时，情况则大有不同！因为每个对等体peer都可以辅助服务器分发文件，本着人多力量大的原则，随着对等体越来越多，分发时间不会像C/S网络那样线性增加。<br>
<span alt="Pasted image 20240620192758.png" src="Pasted image 20240620192758.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240620192758.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240620192758.png"></span><br>
下面，我们用计算来进一步观察在P2P网络下的分发时间的变化。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">在向对等体发送文件之前，我们要先明确最开始的时候只有服务器拥有文件的信息。因此，服务器至少要向接入网络中传输一次。<mark>这次分发时间至少需要<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container></span> 。</mark>（与C/S模式不同，P2P网络的服务器在这一次的传输后就可以撒手人寰了。之后peers会将文件分布在各个peer处。）</li>
<li data-line="1" dir="auto">和C/S体系结构一样，下载速率最慢的对等体接收到 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> bits 也<mark>需要不少于 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-math></mjx-container></span> 的时间。</mark></li>
<li data-line="2" dir="auto">最后，我们看到系统总的上传速率等他所有对等体上传速率相加，即 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-msub space="4"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-script></mjx-msub><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-msub space="3"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msub><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="2"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="2"><mjx-c class="mjx-c2E"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="2"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math></mjx-container></span> 。然后系统将 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> bits的文件分发给 <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi></mjx-math></mjx-container></span> 个对等体。<mark>这时需要最少<span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45C TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D461 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D459 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-math></mjx-container></span>  。</mark></li>
</ul></div><div class="el-p"><p dir="auto">将这三部分合在一块，我们就会得到P2P的分发时间：<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D443 TEX-I"></mjx-c></mjx-mi><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D443 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2265"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c7B"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mfrac space="2"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mfrac space="2"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-munderover space="3" limits="false"><mjx-mo class="mjx-sop"><mjx-c class="mjx-c2211 TEX-S1"></mjx-c></mjx-mo><mjx-script style="vertical-align: -0.285em; margin-left: 0px;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-spacer style="margin-top: 0.291em;"></mjx-spacer><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-munderover><mjx-msub space="2"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n"><mjx-c class="mjx-c7D"></mjx-c></mjx-mo></mjx-math></mjx-container></span>从上面的等式我们看出，P2P结构降低了最小分发时间的负担。若不考虑其他因素，P2P系统的最小分发时间为：<span class="math math-block is-loaded"><mjx-container class="MathJax" jax="CHTML" display="true"><mjx-math display="true" class="MJX-TEX" style="margin-left: 0px; margin-right: 0px;"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D437 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D443 TEX-I"></mjx-c></mjx-mi><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D443 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c7B"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mfrac space="2"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D451 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mfrac space="2"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D439 TEX-I"></mjx-c></mjx-mi></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D446 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-munderover space="3" limits="false"><mjx-mo class="mjx-sop"><mjx-c class="mjx-c2211 TEX-S1"></mjx-c></mjx-mo><mjx-script style="vertical-align: -0.285em; margin-left: 0px;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D441 TEX-I"></mjx-c></mjx-mi></mjx-texatom><mjx-spacer style="margin-top: 0.291em;"></mjx-spacer><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-munderover><mjx-msub space="2"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n"><mjx-c class="mjx-c7D"></mjx-c></mjx-mo></mjx-math></mjx-container></span></p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="BitTorrent" dir="auto" class="heading" id="BitTorrent"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>BitTorrent</h5><div class="heading-children"><div class="el-p"><p dir="auto">BitTorrent 是一个流行的 P2P（点对点）文件分发协议。在 BitTorrent 的术语中，参与特定文件分发的所有节点（peers）的集合被称为一个 “torrent”。在 torrent 中的节点互相下载文件的等大小块（chunks），典型的块大小是 256 KB。当一个节点首次加入 torrent 时，它没有任何块。随着时间的推移，它会逐渐积累越来越多的块。在下载块的同时，它也会上传块给其他节点。一旦一个节点获得了整个文件，它可以选择离开 torrent，或者留在 torrent 中继续向其他节点上传块。此外，任何节点都可以在只有部分块的情况下随时离开 torrent，并且之后可以重新加入 torrent。<br>
<span alt="Pasted image 20240620202147.png" src="Pasted image 20240620202147.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240620202147.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240620202147.png"></span><br>
BitTorrent 是一个复杂的系统，但我们可以通过其最重要的机制来理解它的基本原理。每个 torrent 都有一个叫做 tracker 的基础设施节点。当一个 peer 加入 torrent 时，它会在 tracker 中注册，并定期通知 tracker 它仍然在 torrent 中。这样，tracker 就知道 peers 的数量。</p></div><div class="el-p"><p dir="auto">当一个新的 peer，比如 Alice，加入 torrent 时，tracker 会从参与的 peers 中随机选择一部分（比如说50个）并将这些 peers 的 IP 地址发送给 Alice。Alice 拥有了这个 peers 列表后，会尝试与列表上的所有 peers 建立并发的 TCP 连接。我们称 Alice 成功建立 TCP 连接的 peers 为 “neighboring peers”。随着时间的推移，一些 peers 可能会离开，而其他的 peers（不在最初的50个之内）可能会尝试与 Alice 建立 TCP 连接。因此，一个 peer 的neighboring peers 的数量会随时间波动。</p></div><div class="el-p"><p dir="auto">在任何给定的时间点，每个 peer 都会拥有文件的一部分 chunks，不同的 peers 拥有不同的 chunks 子集。Alice 会定期向她的neighboring peers 请求他们拥有的 chunks 列表。如果 Alice 有 L 个不同的neighbor，她将获得 L 个 chunks 列表。知道这些后，Alice 可以请求她当前没有的 chunks。</p></div><div class="el-p"><p dir="auto">因此，在任何时候，Alice 都会拥有一部分 chunks，而且知道她的邻居拥有哪些 chunks。有了这些信息，Alice 需要做出两个重要的决定：首先，她应该首先向邻居请求哪些 chunks? 其次，她应该向哪些邻居发送请求的 chunks？在决定请求哪些 chunks 时，Alice 使用了一种叫做 “rarest first” 的技术。Rearest first 用来确定在她没有的 chunks 中，哪些 chunks 是在她的邻居中重复次数最少的 ，然后最先请求这些最稀有的 chunks。这样，最稀有的 chunks 能更快地被重新分配，目的是（大致）使 torrent 中每个 chunks 的副本数量均衡。</p></div><div class="el-p"><p dir="auto">为了确定她应该回应哪些请求，BitTorrent 使用了一个巧妙的“交易”算法。基本思想是 Alice 优先回应那些当前以最高速率向她提供数据的邻居。具体来说，对于她的每个邻居，Alice 持续测量她接收比特的速率，并确定四个以最高速率向她提供比特的 peers。然后她通过向这四个相同的 peers 发送 chunks 来回报他们。每10秒，她会重新计算速率，并可能修改这四个 peers 的集合。在 BitTorrent 术语中，这四个 peers 被称为 unchoked peer。重要的是，每30秒，她还会随机选择一个额外的邻居并向其发送 chunks。我们称这个随机选择的 peer 为 Bob。这时的 Bob 就是 optimistically unchoked peer。因为 Alice 向 Bob 发送数据，她可能会成为 Bob 的前四个上传者之一，这样 Bob 就会开始向 Alice 发送数据。如果 Bob 向 Alice 发送数据的速率足够高，Bob 可能会反过来成为 Alice 的前四个上传者之一。换句话说，每30秒，Alice 会随机选择一个新的交易伙伴并开始与该伙伴交易。如果两个 peers 对交易感到满意，他们会将对方放入他们的前四个列表中，并继续彼此交易，直到其中一个 peer 找到更好的伙伴。这样，能够以兼容速率上传的 peers 往往能够找到彼此。随机邻居选择也允许新的 peers 获得 chunks，这样他们就有东西可以交易。除了这五个 peers（四个“顶级” peers 和一个探测 peer）之外的所有其他邻居 peers 都被 “choked”，即他们不会从 Alice 那里接收任何 chunks。BitTorrent 还有许多其他有趣的机制，这里没有讨论，包括 pieces（小 chunks）、pipelining、random first selection、endgame mode 和 anti-snubbing。</p></div><div class="el-p"><p dir="auto">刚才描述的交易激励机制通常被称为 tit-for-tat。尽管已经有研究表明这种激励方案可以被规避，但 BitTorrent 生态系统仍然非常成功，有数百万个同时在线的 peers 在数十万个 torrents 中积极分享文件。如果 BitTorrent 没有设计 tit-for-tat（或其变体），即使其他方面完全相同，BitTorrent 都可能不会存在，因为大多数用户只想作为数据的接收者。</p></div><div class="el-p"><p dir="auto">最后，我们简要提及 P2P 的另一个应用，即分布式哈希表（DHT）。分布式哈希表是一个简单的数据库，数据库记录分布在 P2P 系统的 peers 中。DHT 已被广泛实施（例如，在 BitTorrent 中）并且是广泛研究的主题。在配套网站的视频笔记中提供了一个概述。</p></div></div></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="2.6 Viedo Streaming and Content Distribution Networks" dir="auto" class="heading" id="2.6_Viedo_Streaming_and_Content_Distribution_Networks"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.6 Viedo Streaming and Content Distribution Networks</h2><div class="heading-children"><div class="el-p"><p dir="auto"><em>By many estimates, streaming video account for about 80% of Internet traffic in 2020. [Cisco 2020]</em></p></div><div class="el-p"><p dir="auto">本节课中，我们会简单了解当今网络世界中的视频流服务是怎么实现的。我们会看看这些 streaming video 是如何用应用层协议和一些 cache-like 的服务实现的。</p></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.6.1 Internet Video" dir="auto" class="heading" id="2.6.1_Internet_Video"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.6.1 Internet Video</h3><div class="heading-children"><div class="el-p"><p dir="auto">在流存储视频应用(streaming stored video applications)中，underlying medium 就是提前录制好的视频。这些视频会被放置在服务器中，如何client向服务器发送需要视频的请求报文。</p></div><div class="el-p"><p dir="auto">那么什么是 video medium 呢？我们要先明白视频就是一连串的图片，我们常常听到24帧、30帧60帧的视频。这表示视频每秒钟会显示60帧（张）的图片。而这些图片又是由一连串的像素构成的，这些像素由可以用表示亮度和颜色的 bits 来表示。这是压缩(compression)的过程，也是视频的特点之一 —— 将视频文件压缩成任何所需的比特率(bit rate)。比特率越高视频的质量越高。</p></div><div class="el-p"><p dir="auto">从网络的视角来看，video 最重要的特征可能就是比特率了。一般来说，压缩后网络视频的比特率通常在100Kbps 到 4Mbps。如果想要传输4K以上的视频，那么至少需要10Mbps的比特率，这样会占用大量的网络和存储资源。为保证视频持续稳定的传输，网络就必须提供比压缩视频比特率还大的网络吞吐量(throughput)。</p></div><div class="el-p"><p dir="auto">如果端到端的吞吐量小于压缩视频的比特率，我们还可以将源视频压缩成不同比特率的版本，中断设备根据当前网络吞吐量来选择多大比特率的版本。这也就是为什么视频网站上会存在144p、480p、1080p、2k、4k多个版本的视频供用户选择。</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.6.2 HTTP Streaming and DASH" dir="auto" class="heading" id="2.6.2_HTTP_Streaming_and_DASH"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.6.2 HTTP Streaming and DASH</h3><div class="heading-children"><div class="el-p"><p dir="auto">当视频采用HTTP媒体流(HTTP streaming)传输时，视频会存放在HTTP服务器的一个URL处。当用户想要观看视频时，client会建立与server的TCP连接并通过HTTP <code>GET</code> 方式来获取这个视频。之后，server会将视频文件包含在一个响应报文中发给client。在client端，压缩后的视频（bits）会先存放在client application buffer中。一旦buffer中的字节数量到预设阈值的时候，client端的应用就会开始播放视频。</p></div><div class="el-p"><p dir="auto">尽管HTTP streaming 得到极为广泛地应用，但它仍然有一个缺点：即所有的client都会收到同样比特率的视频。这样的特点没有充分考虑到不同client目前可用带宽的大小。因此也促成 <strong>DASH(Dynamic Adaptive Streaming HTTP)技术</strong> 的发展。动态自适应流媒体技术将视频编码成多个比特率的版本，client会动态地请求一段长度的视频片段。根据目前的带宽选择响应比特率版本的视频。</p></div><div class="el-p"><p dir="auto">DASH技术的出现使不同网络状况的clients能够在不同编码率下享受流媒体视频中的内容。同时DASH也支持在会话中根据网络状况动态地选择不同比特率版本。</p></div><div class="el-p"><p dir="auto">有了DASH，每种不同比特率版本的视频都将存放在HTTP的服务器中，每种视频都与单一的URL相对应。而这些URL信息可以在HTTP服务器中的 <strong>清单文件(manifest file)</strong> 中看到。</p></div><div class="el-p"><p dir="auto">我们最后再来在宏观上看看video是如何在server-client上传输的：</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">客户端初始化与服务器的TCP连接；</li>
<li data-line="1" dir="auto">TCP连接建立完成，客户端使用HTTP <code>GET</code> 方法请求想要的video文件的一个chunk；</li>
<li data-line="2" dir="auto">服务器将清单文件(manifest file)发送给客户端；</li>
<li data-line="3" dir="auto">客户端根据目前的网络状况在清单文件中选择合适的video chunk；</li>
<li data-line="4" dir="auto">服务器端压缩video chunk成bit stream并发送给客户端；</li>
<li data-line="5" dir="auto">客户端解码bit stream成video chunk并隔一段时间跳转到第3步。</li>
</ol></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.6.3 Content Distribution Networks" dir="auto" class="heading" id="2.6.3_Content_Distribution_Networks"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.6.3 Content Distribution Networks</h3><div class="heading-children"><div class="el-p"><p dir="auto">当今，许多流媒体视频公司需要将这些视频内容分布式地放在世界各地来时时刻刻为百万计的用户提供稳定的视频播放。</p></div><div class="el-p"><p dir="auto">那么如何为这些用户提供稳定的视频播放呢？我们可以建造一个巨型的数据中心(mega data center)，将所有的视频都存放在数据中心里。但这样做会造成很多问题：</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">当client物理距离过大时，传播时延(Propagation Delay)会变得很大，在这种情况下，视频可能会经由多个ISP才能送到client端。如果在传输过程中有一条线路的吞吐率小于视频的比特率，回想我们第一章中了解的bottleneck link，这时的线路最大吞吐率将由这条bottleneck link决定！</li>
<li data-line="1" dir="auto">服务器会重复发送更加流行的视频，这样会浪费网络带宽。</li>
<li data-line="2" dir="auto">由于单一数据中心并没有备用服务器作为备份，如果这个数据中心瘫痪或和其连接的线路故障，那么data center就不会往外发送任何视频流了。</li>
</ol></div><div class="el-p"><p dir="auto">为应对百万计clients的视频流请求，现在大部分公司都会采用<strong>Content Distribution Networks(CDNs)</strong>。<mark>内容分发网络</mark>通过管理分布在不同位置的服务器，将video、其他Web内容拷贝到不同的服务器（服务器农场）中。每当有用户发起内容请求，CDN就会让用户与最合适的data center进行通信，以获得最好的体验。CDN可以是私有(Private CDN)的，只为内容提供商所有。CDN也可以是第三方的(third-party CDN)，由多个内容提供商分发内容。<br>
<em>A very readable overview of modern CDNs is [Leighton 2009; Nygren 2010].</em></p></div><div class="el-p"><p dir="auto">CDNs的分布有两种不同的设计哲学：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><strong>Enter Deep</strong>*：这种策略由Akamai首创，它涉及将服务器集群部署在全球各地互联网服务提供商的接入网络中，深入到用户所在的位置。(To get close to users)</li>
<li data-line="1" dir="auto"><strong>Bring Home/Edge-based Plasement</strong>*：在这种方法中，CDN服务器被放置在网络的边缘，更靠近最终用户。这样做可以减少内容传输的延迟，加快内容交付速度。(To bring the ISPs home)</li>
</ul></div><div class="el-p"><p dir="auto">我们做假设来理解这两种策略：假设圆的内部是network core，圆上是network edge。那么在enter deep方式中，CDN靠近一个圆的圆心，它平等的到每个client都近。而bring home更像是将CDN放在圆上，这样对一部分用户更近，但是对另外一些用户来说却更远。</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="CDN Operation" dir="auto" class="heading" id="CDN_Operation"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>CDN Operation</h5><div class="heading-children"><div class="el-p"><p dir="auto">了解完CDNs的两种分布策略之后，我们现在看看CDN是任何发挥作用的。当client host想要获得一个video时，CDN必须拦截(intercept)该请求并根据请求（1）决定此时刻最适合该client的CDN服务器集群；（2）将client的请求引导发送到那个集群中的服务器。</p></div><div class="el-p"><p dir="auto">下面，我们用一张图直观地理解CDN的作用。我们假设有一个内容提供商（NetCinema）从 KingCDN 租用了一个第三方的CDN来完成其视频分发。在 NetCinema 网页中，每个视频都对应一个URL与其对应。在用户想要观看某个视频且视频流被送到用户的host上前，发生了以下事件：</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">用户访问 NetCinema 网页；</li>
<li data-line="1" dir="auto">在用户点击链接 \<a data-tooltip-position="top" aria-label="http://video.netcinema.com/XXXXX%5C" rel="noopener nofollow" class="external-link" href="http://video.netcinema.com/XXXXX%5C" target="_blank">http://video.netcinema.com/XXXXX\</a> 后，用户host发送关于 <code>video.netcinema.com</code> DNS query 报文；</li>
<li data-line="2" dir="auto">用户的 Local DNS Server(LDNS)向 NetCinema 的权威DNS服务器发送 DNS query 报文。由于 NetCinema 的视频资源都由第三方 KingCDN 管理，所以 NetCinema 的权威DNS服务器会将 KingCND的域名，如 <code>xxxxx.kingcdn.com</code> 交给 LDNS。</li>
<li data-line="3" dir="auto">知道了KingCND的域名，现在我们的发出的 DNS query 就可以进到 KingCDN 的私人 DNS infrastructure中了。然后，用户的 LDNS 发送关于 <code>xxxxx.kingcdn.com</code>的 DNS query 之后 LDNS 收到 KingCDN 的内容服务器的IP地址。</li>
<li data-line="4" dir="auto">有了 KingCDN 内容服务器的IP地址，LDNS 将IP地址转发给client host。</li>
<li data-line="5" dir="auto">Client host通过IP地址与目标服务器建立TCP连接，之后使用HTTP <code>GET</code>来获得想要的内容。如果使用 DASH ，服务器还会先将包含一连串URLs的清单文件发送给 client host ，然后 client host 通过目前的网络状态动态地选择需要的视频chunk文件。<br>
<span alt="Pasted image 20240622153238.png" src="Pasted image 20240622153238.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240622153238.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240622153238.png"></span></li>
</ol></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Cluster Selection Strategies" dir="auto" class="heading" id="Cluster_Selection_Strategies"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Cluster Selection Strategies</h5><div class="heading-children"><div class="el-p"><p dir="auto">在CND分发内容的时候，往往要考虑怎么选择合适的 <strong>cluster selection strategy</strong>。集群选择策略是在client host 进行查询时，CDN通过 LDNS 的IP地址来为其推荐最合适的服务器集群(cluster)。</p></div><div class="el-p"><p dir="auto">CDN往往采用专有的集群选择策略。一种笨想的策略就是 <strong>geographically closest</strong>，就是根据物理距离的长短让距离 client host 最近的服务器集群（也就是数据中心）负责向 client host 传输内容信息。Content provider 会使用商业性的 geo-location databases 来获取地理位置上的信息。这种方式对与大多数用户而言都是相对较优的，但对 “Geographically close, driven far” 的情况来说，这种策略的体验可能会很差。因为地理距离上的cluster可能在跳数(number of hops)上可能不是最小的。</p></div><div class="el-p"><p dir="auto">Tip*<em>在下图的例子就很好地说明了这个问题，虽然两地相距120+km，但是开车确需要1300+km。</em><br>
<span alt="Pasted image 20240622164243.png" src="Pasted image 20240622164243.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240622164243.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240622164243.png"></span></p></div><div class="el-p"><p dir="auto">为了解决这种问题，基于client host当前的网络状况来选择最佳的集群，CDNs可以使用 <strong>real-time measurements</strong> 策略周期性地检查与client host之间的延时（如使用<code>ping</code>命令）等来选择cluster。</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.6.4 Case Studies: Netflix and YouTube" dir="auto" class="heading" id="2.6.4_Case_Studies:_Netflix_and_YouTube"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.6.4 Case Studies: Netflix and YouTube</h3><div class="heading-children"><div class="el-p"><p dir="auto"><em>2.6.4小节作为了解性内容。</em></p></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="2.7 Socket Programming" dir="auto" class="heading" id="2.7_Socket_Programming"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.7 Socket Programming</h2><div class="heading-children"><div class="el-p"><p dir="auto">回顾2.1节，我们讨论了由两部分组成的网络应用——客户端程序和服务器程序——运行在两台end systems上。当程序一旦被运行，客户端进程和服务器进程就会被创建，然后这些进程靠sockets进行客户端-服务器之间的读、写操作。要进行这样的客户机-服务器间的通信，程序员就要编写客户端程序和服务器端程序。</p></div><div class="el-p"><p dir="auto">我们可以使用现成的[RFC]文档或其他开源的标准文档提供的协议标准来完成我们的网络应用程序（如使用HTTP[RFC 2616]来作为服务器和客户端程序的指导文档）。依这种方式，客户端程序和服务器程序的读、写操作的实现就需要安装文档规定的方式实现。<br>
之外，我们还可以使用自己规定的读写接口协议来实现我们的客户端程序和服务器程序。这种方式下实现的网络应用往往是闭源私有的。</p></div><div class="el-p"><p dir="auto">我们再回顾TCP和UDP的特点。我们知道，TCP是面向连接(connection oriented) 的网络层协议，为两台终端设备之间提供可靠的字节流信道。<br>
而UDP是无连接的，它提供不可靠的、以独立传输包(independent packets)方式传输的，对传输过程中发生的意外不做任何保证。</p></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.7.1 Socket Programming with UDP" dir="auto" class="heading" id="2.7.1_Socket_Programming_with_UDP"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.7.1 Socket Programming with UDP</h3><div class="heading-children"><div class="el-p"><p dir="auto">我们将<mark>主机</mark>比做街道，<mark>应用进程</mark>比作房子，进程的<mark>端口号/sockets</mark>用房子的门牌号来表示，模拟<mark>数据包</mark>传输为快递运送的过程。<br>
我们来模拟一次数据包传输的过程：现在有一个快递包需要从房子A邮递到房屋B，我们需要在快递包上写很多邮寄信息，如送到哪个街道（主机）的哪个房子（进程）门牌号（端口号）是多少。快递员会根据这些信息将快递包送到指定的房子。</p></div><div class="el-p"><p dir="auto">作为生活在房子里面的程序员，我们完全有随意布置房间和发送什么快递包的权力。但是我们不能影响到房间外快递员是如何配送包裹的。这也就是我们所说的开发者只对<strong>socket接口的application-layer side</strong>有完全的掌握，但对传输层一侧几乎没有控制。</p></div><div class="el-p"><p dir="auto">如果还是不理解，不妨从网络视角再看看数据包传输的问题。在网络中，路由器会解析IP地址并将数据转发到正确的主机上，而主机上有许多进程，一个进程又可以有多个sockets，因此我们需要端口号来对这些socket进行标识。因而，有了<strong>IP地址和端口号</strong>，我们就可以将数据包送去目标主机了。</p></div><div class="el-p"><p dir="auto">我们用下面的客户机-服务器应用的规则来演示一下UDP和TCP上的socket编程：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">client从键盘读入一行数据（characters）并将其转发给server；</li>
<li data-line="1" dir="auto">server收到数据并将其转化成大写形式；</li>
<li data-line="2" dir="auto">server将修改后的数据发给client；</li>
<li data-line="3" dir="auto">client收到修改后的数据并将其显示到屏幕上。</li>
</ul></div><div class="el-p"><p dir="auto">我们在下图中用高亮表示客户端-服务器<mark>基于UDP传输服务上的相关socket活动</mark>：<br>
<span alt="Pasted image 20240704180831.png" src="Pasted image 20240704180831.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240704180831.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240704180831.png"></span></p></div><div class="el-h5 heading-wrapper"><h5 data-heading="Client UDP Programming" dir="auto" class="heading" id="Client_UDP_Programming"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Client UDP Programming</h5><div class="heading-children"><div class="el-blockquote"><blockquote dir="auto">
<p><em>原书用 python 进行应用端对传输层协议的选择配置编程。相比 C++更容易理解和学习。</em></p>
</blockquote></div><div class="el-pre"><pre class="language-cpp" tabindex="0"><code data-line="0" class="language-cpp is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> <span class="token comment">// 引入输入输出流库，用于控制台输入输出。</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span> <span class="token comment">// 引入字符串处理库，提供字符串操作函数。</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span> <span class="token comment">// 引入套接字接口库，用于网络通信。</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span> <span class="token comment">// 引入用于IP地址转换的库。</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span> <span class="token comment">// 引入POSIX操作系统API库。</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PORT</span> <span class="token expression"><span class="token number">8080</span> </span><span class="token comment">// 定义服务器监听的端口号为8080。</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span> </span><span class="token comment">// 定义缓冲区大小为1024字节。</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> sockfd<span class="token punctuation">;</span> <span class="token comment">// 套接字文件描述符，用于标识创建的套接字。</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 缓冲区数组，用于存储输入的消息和服务器的响应。</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span> <span class="token comment">// 服务器地址结构体，用于存储服务器的地址信息。</span>

    <span class="token comment">// 创建UDP socket</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket creation failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果创建套接字失败，打印错误信息。</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 退出程序。</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 配置服务器地址</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化服务器地址结构体。</span>
    server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span> <span class="token comment">// 设置地址族为IPv4。</span>
    server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置端口号，htons用于将主机字节序转换为网络字节序。</span>
    server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> INADDR_ANY<span class="token punctuation">;</span> <span class="token comment">// 设置IP地址为任意地址，即本机的任意IP。</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 无限循环，直到程序被手动停止。</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Enter a message: "</span><span class="token punctuation">;</span> <span class="token comment">// 提示用户输入消息。</span>
        std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从标准输入读取一行数据到缓冲区。</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Message has been loaded! "</span><span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token comment">// 发送数据到服务器</span>
        <span class="token function">sendto</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Message has been sent! "</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token comment">// 接收服务器的响应</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">recvfrom</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接收服务器响应的数据。</span>
        buffer<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> <span class="token comment">// 在消息末尾添加字符串结束符。</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Server response: "</span> <span class="token operator">&lt;&lt;</span> buffer <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 打印服务器的响应。</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭套接字。</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 程序正常退出。</span>
<span class="token punctuation">}</span>

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Server UDP Programming" dir="auto" class="heading" id="Server_UDP_Programming"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Server UDP Programming</h5><div class="heading-children"><div class="el-pre"><pre class="language-cpp" tabindex="0"><code data-line="0" class="language-cpp is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PORT</span> <span class="token expression"><span class="token number">8080</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span>

<span class="token keyword">void</span> <span class="token function">to_uppercase</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">transform</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> str <span class="token operator">+</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token double-colon punctuation">::</span>toupper<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> sockfd<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">,</span> client_addr<span class="token punctuation">;</span>
    socklen_t addr_len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>client_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建UDP socket</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket creation failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 配置服务器地址</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> INADDR_ANY<span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 绑定socket到地址</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>
	    server_addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"bind failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 接收数据</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">recvfrom</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>addr_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Received: "</span> <span class="token operator">&lt;&lt;</span> buffer <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

        <span class="token comment">// 转换为大写</span>
        <span class="token function">to_uppercase</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 发送修改后的数据</span>
        <span class="token function">sendto</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span> addr_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Sent: "</span> <span class="token operator">&lt;&lt;</span> buffer <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.7.2 Socket Programming with TCP" dir="auto" class="heading" id="2.7.2_Socket_Programming_with_TCP"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.7.2 Socket Programming with TCP</h3><div class="heading-children"><div class="el-p"><p dir="auto">与UDP提供的无连接服务不同，TCP提供有连接的服务。所以，在客户端和服务器端进程相互传递信息前，我们需要先通过握手(handshakes)建立TCP连接。然后用客户端connection socket和服务器connection socket建立起TCP连接。因为是面向连接的，因此在一端想向另一端发送信息时，只需要将信息送给connection socket，而不需要向UDP那样在数据包中额外加入IP地址和端口号等信息。</p></div><div class="el-p"><p dir="auto">我们还要明确，在客户进程初始化TCP连接前需要：</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">服务器端的进程必须先运行起来；（UDP同）</li>
<li data-line="1" dir="auto">服务器进程还要提供一个额外的socket用来进行连接的确定。<br>
简单理一下过程：（1）客户进程和服务进程先创建套接字 socket；（2）客户进程用三次握手(three-way handshake)初始化TCP连接，这一步是在运输层发生的 ，对应用进程不可见。</li>
</ol></div><div class="el-p"><p dir="auto">在服务进程上，它会一开始一直监听是否有客户进程与它建立TCP连接，一旦连接建立，服务器进程就会创建一个属于当前客户进程的connection socket。如下图所示，连接建立后，客户进程和服务器进程就会通过一个管道(pipe)来传输信息。TCP保证服务器进程/客户进程按序收到客户进程/服务器进程发送的全部字节，所以我们说TCP在客户进程和服务器进程间提供可靠的服务。<br>
<span alt="Pasted image 20240705114457.png" src="Pasted image 20240705114457.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240705114457.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240705114457.png"></span></p></div><div class="el-h5 heading-wrapper"><h5 data-heading="Client TCP Programming" dir="auto" class="heading" id="Client_TCP_Programming"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Client TCP Programming</h5><div class="heading-children"><div class="el-pre"><pre class="language-cpp" tabindex="0"><code data-line="0" class="language-cpp is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PORT</span> <span class="token expression"><span class="token number">8080</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> sock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> serv_addr<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string message<span class="token punctuation">;</span>

    <span class="token comment">// 创建socket文件描述符</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sock <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"Socket creation error\n"</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    serv_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    serv_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 将地址转换为二进制形式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">inet_pton</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>serv_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"Invalid address/ Address not supported\n"</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 连接服务器</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>serv_addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>serv_addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"Connection Failed\n"</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 从键盘读取数据并发送到服务器</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Enter message: "</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">getline</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">send</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 接收服务器返回的数据并显示</span>
    <span class="token function">read</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Modified message from server: "</span> <span class="token operator">&lt;&lt;</span> buffer <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token function">close</span><span class="token punctuation">(</span>sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="Server TCP Programming" dir="auto" class="heading" id="Server_TCP_Programming"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Server TCP Programming</h5><div class="heading-children"><div class="el-pre"><pre class="language-cpp" tabindex="0"><code data-line="0" class="language-cpp is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cctype&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PORT</span> <span class="token expression"><span class="token number">8080</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span>

<span class="token keyword">void</span> <span class="token function">to_uppercase</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        str<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> server_fd<span class="token punctuation">,</span> new_socket<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> address<span class="token punctuation">;</span>
    <span class="token keyword">int</span> opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> addrlen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建socket文件描述符</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 绑定端口</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_REUSEADDR <span class="token operator">|</span> SO_REUSEPORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>opt<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"setsockopt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    address<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    address<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> INADDR_ANY<span class="token punctuation">;</span>
    address<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>address<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"bind failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 监听</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"listen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 接受客户端连接</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>new_socket <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>address<span class="token punctuation">,</span> <span class="token punctuation">(</span>socklen_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"accept"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 读取数据并转换为大写</span>
    <span class="token function">read</span><span class="token punctuation">(</span>new_socket<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">to_uppercase</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">send</span><span class="token punctuation">(</span>new_socket<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Modified message sent back to client\n"</span><span class="token punctuation">;</span>

    <span class="token function">close</span><span class="token punctuation">(</span>new_socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20240705115300.png" src="Pasted image 20240705115300.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20240705115300.png" src="computer-networking-a-top-down-approach/pics/pasted-image-20240705115300.png"></span></p></div><div class="mod-footer mod-ui"></div></div></div></div></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Chapter 2: Application Layer"><div class="tree-item-contents heading-link" heading-name="Chapter 2: Application Layer"><span class="tree-item-title">Chapter 2: Application Layer</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.1_Principals_of_Network_Applications"><div class="tree-item-contents heading-link" heading-name="2.1 Principals of Network Applications"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.1 Principals of Network Applications</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.1.1_Network_Application_Architectures"><div class="tree-item-contents heading-link" heading-name="2.1.1 Network Application Architectures"><span class="tree-item-title">2.1.1 Network Application Architectures</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.1.2_Processes_Communicating"><div class="tree-item-contents heading-link" heading-name="2.1.2 Processes Communicating"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.1.2 Processes Communicating</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Client_and_Server_Processes"><div class="tree-item-contents heading-link" heading-name="Client and Server Processes"><span class="tree-item-title">Client and Server Processes</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#The_Interface_Between_the_Process_and_the_Computer_Network"><div class="tree-item-contents heading-link" heading-name="The Interface Between the Process and the Computer Network"><span class="tree-item-title">The Interface Between the Process and the Computer Network</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Addressing_Processes"><div class="tree-item-contents heading-link" heading-name="Addressing Processes"><span class="tree-item-title">Addressing Processes</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.1.3_Transport_Services_Available_to_Applications"><div class="tree-item-contents heading-link" heading-name="2.1.3 Transport Services Available to Applications"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.1.3 Transport Services Available to Applications</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Reliable_Data_Transfer"><div class="tree-item-contents heading-link" heading-name="Reliable Data Transfer"><span class="tree-item-title">Reliable Data Transfer</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Throughput"><div class="tree-item-contents heading-link" heading-name="Throughput"><span class="tree-item-title">Throughput</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Timing"><div class="tree-item-contents heading-link" heading-name="Timing"><span class="tree-item-title">Timing</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Security"><div class="tree-item-contents heading-link" heading-name="Security"><span class="tree-item-title">Security</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.1.4_Transport_Services_Provided_by_the_Internet"><div class="tree-item-contents heading-link" heading-name="2.1.4 Transport Services Provided by the Internet"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.1.4 Transport Services Provided by the Internet</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#TCP_Services"><div class="tree-item-contents heading-link" heading-name="TCP Services"><span class="tree-item-title">TCP Services</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#UDP_Services"><div class="tree-item-contents heading-link" heading-name="UDP Services"><span class="tree-item-title">UDP Services</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Services_Not_Provided_by_Internet_Transport_Protocols"><div class="tree-item-contents heading-link" heading-name="Services Not Provided by Internet Transport Protocols"><span class="tree-item-title">Services Not Provided by Internet Transport Protocols</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.1.5_Application-Layer_Protocols"><div class="tree-item-contents heading-link" heading-name="2.1.5 Application-Layer Protocols"><span class="tree-item-title">2.1.5 Application-Layer Protocols</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.1.6_Network_Applications_Covered_in_This_Book"><div class="tree-item-contents heading-link" heading-name="2.1.6 Network Applications Covered in This Book"><span class="tree-item-title">2.1.6 Network Applications Covered in This Book</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.2_The_Web_and_HTTP"><div class="tree-item-contents heading-link" heading-name="2.2 The Web and HTTP"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2 The Web and HTTP</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.2.1_Overview_of_HTTP"><div class="tree-item-contents heading-link" heading-name="2.2.1 Overview of HTTP"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2.1 Overview of HTTP</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#HTTP相关概念"><div class="tree-item-contents heading-link" heading-name="HTTP相关概念"><span class="tree-item-title">HTTP相关概念</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.2.2_Non-Persistent_and_Persistent_Connection"><div class="tree-item-contents heading-link" heading-name="2.2.2 Non-Persistent and Persistent Connection"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2.2 Non-Persistent and Persistent Connection</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#HTTP_with_Non-Persistent_Connections"><div class="tree-item-contents heading-link" heading-name="HTTP with Non-Persistent Connections"><span class="tree-item-title">HTTP with Non-Persistent Connections</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#HTTP_with_Persistent_Connections"><div class="tree-item-contents heading-link" heading-name="HTTP with Persistent Connections"><span class="tree-item-title">HTTP with Persistent Connections</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.2.3_HTTP_Message_Format"><div class="tree-item-contents heading-link" heading-name="2.2.3 HTTP Message Format"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2.3 HTTP Message Format</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#HTTP_Request_Massage"><div class="tree-item-contents heading-link" heading-name="HTTP Request Massage"><span class="tree-item-title">HTTP Request Massage</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#HTTP_Response_Message"><div class="tree-item-contents heading-link" heading-name="HTTP Response Message"><span class="tree-item-title">HTTP Response Message</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.2.4_User-Server_Interation:_Cookies"><div class="tree-item-contents heading-link" heading-name="2.2.4 User-Server Interation: Cookies"><span class="tree-item-title">2.2.4 User-Server Interation: Cookies</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.2.5_Web_Caching"><div class="tree-item-contents heading-link" heading-name="2.2.5 Web Caching"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2.5 Web Caching</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#The_Conditional_GET"><div class="tree-item-contents heading-link" heading-name="The Conditional GET"><span class="tree-item-title">The Conditional GET</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.2.6_HTTP/2"><div class="tree-item-contents heading-link" heading-name="2.2.6 HTTP/2"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2.6 HTTP/2</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#HTTP/2_Framing"><div class="tree-item-contents heading-link" heading-name="HTTP/2 Framing"><span class="tree-item-title">HTTP/2 Framing</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Responce_Message_Prioritization_and_Server_Pushing"><div class="tree-item-contents heading-link" heading-name="Responce Message Prioritization and Server Pushing"><span class="tree-item-title">Responce Message Prioritization and Server Pushing</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#HTTP/3"><div class="tree-item-contents heading-link" heading-name="HTTP/3"><span class="tree-item-title">HTTP/3</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.25_File_Tranfer_Protocol\*"><div class="tree-item-contents heading-link" heading-name="2.25 File Tranfer Protocol\*"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.25 File Tranfer Protocol*</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#FTP:_文件传输协议"><div class="tree-item-contents heading-link" heading-name="FTP: 文件传输协议"><span class="tree-item-title">FTP: 文件传输协议</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#FTP:_控制连接与数据连接分开"><div class="tree-item-contents heading-link" heading-name="FTP: 控制连接与数据连接分开"><span class="tree-item-title">FTP: 控制连接与数据连接分开</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#FTP命令、响应"><div class="tree-item-contents heading-link" heading-name="FTP命令、响应"><span class="tree-item-title">FTP命令、响应</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.3_Electronic_Mail_in_the_Internet"><div class="tree-item-contents heading-link" heading-name="2.3 Electronic Mail in the Internet"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.3 Electronic Mail in the Internet</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#SMTP"><div class="tree-item-contents heading-link" heading-name="SMTP"><span class="tree-item-title">SMTP</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.3.2_Mail_Message_Formats"><div class="tree-item-contents heading-link" heading-name="2.3.2 Mail Message Formats"><span class="tree-item-title">2.3.2 Mail Message Formats</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.3.3_Mail_Access_Protocols"><div class="tree-item-contents heading-link" heading-name="2.3.3 Mail Access Protocols"><span class="tree-item-title">2.3.3 Mail Access Protocols</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.4_DNS-The_Internet's_Directory_Service"><div class="tree-item-contents heading-link" heading-name="2.4 DNS-The Internet's Directory Service"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.4 DNS-The Internet's Directory Service</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.4.1_Services_Provided_by_DNS"><div class="tree-item-contents heading-link" heading-name="2.4.1 Services Provided by DNS"><span class="tree-item-title">2.4.1 Services Provided by DNS</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.4.2_Overview_of_How_DNS_Works"><div class="tree-item-contents heading-link" heading-name="2.4.2 Overview of How DNS Works"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.4.2 Overview of How DNS Works</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#A_Disruibuted,_Hierarchical_Database"><div class="tree-item-contents heading-link" heading-name="A Disruibuted, Hierarchical Database"><span class="tree-item-title">A Disruibuted, Hierarchical Database</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#DNS_Caching"><div class="tree-item-contents heading-link" heading-name="DNS Caching"><span class="tree-item-title">DNS Caching</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.4.3_DNS_Records_and_Messages"><div class="tree-item-contents heading-link" heading-name="2.4.3 DNS Records and Messages"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.4.3 DNS Records and Messages</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#DNS_Messages"><div class="tree-item-contents heading-link" heading-name="DNS Messages"><span class="tree-item-title">DNS Messages</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Inserting_Records_into_the_DNS_Database"><div class="tree-item-contents heading-link" heading-name="Inserting Records into the DNS Database"><span class="tree-item-title">Inserting Records into the DNS Database</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.5_Peer-to-Peer_File_Distribution"><div class="tree-item-contents heading-link" heading-name="2.5 Peer-to-Peer File Distribution"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.5 Peer-to-Peer File Distribution</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.5.1_Scalability_of_P2P_Architecture"><div class="tree-item-contents heading-link" heading-name="2.5.1 Scalability of P2P Architecture"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.5.1 Scalability of P2P Architecture</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Distribution_Time_for_Client/Server_Architecture"><div class="tree-item-contents heading-link" heading-name="Distribution Time for Client/Server Architecture"><span class="tree-item-title">Distribution Time for Client/Server Architecture</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Distribution_Time_for_P2P_Architecture"><div class="tree-item-contents heading-link" heading-name="Distribution Time for P2P Architecture"><span class="tree-item-title">Distribution Time for P2P Architecture</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#BitTorrent"><div class="tree-item-contents heading-link" heading-name="BitTorrent"><span class="tree-item-title">BitTorrent</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.6_Viedo_Streaming_and_Content_Distribution_Networks"><div class="tree-item-contents heading-link" heading-name="2.6 Viedo Streaming and Content Distribution Networks"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.6 Viedo Streaming and Content Distribution Networks</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.6.1_Internet_Video"><div class="tree-item-contents heading-link" heading-name="2.6.1 Internet Video"><span class="tree-item-title">2.6.1 Internet Video</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.6.2_HTTP_Streaming_and_DASH"><div class="tree-item-contents heading-link" heading-name="2.6.2 HTTP Streaming and DASH"><span class="tree-item-title">2.6.2 HTTP Streaming and DASH</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.6.3_Content_Distribution_Networks"><div class="tree-item-contents heading-link" heading-name="2.6.3 Content Distribution Networks"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.6.3 Content Distribution Networks</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#CDN_Operation"><div class="tree-item-contents heading-link" heading-name="CDN Operation"><span class="tree-item-title">CDN Operation</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Cluster_Selection_Strategies"><div class="tree-item-contents heading-link" heading-name="Cluster Selection Strategies"><span class="tree-item-title">Cluster Selection Strategies</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.6.4_Case_Studies:_Netflix_and_YouTube"><div class="tree-item-contents heading-link" heading-name="2.6.4 Case Studies: Netflix and YouTube"><span class="tree-item-title">2.6.4 Case Studies: Netflix and YouTube</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.7_Socket_Programming"><div class="tree-item-contents heading-link" heading-name="2.7 Socket Programming"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.7 Socket Programming</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.7.1_Socket_Programming_with_UDP"><div class="tree-item-contents heading-link" heading-name="2.7.1 Socket Programming with UDP"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.7.1 Socket Programming with UDP</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Client_UDP_Programming"><div class="tree-item-contents heading-link" heading-name="Client UDP Programming"><span class="tree-item-title">Client UDP Programming</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Server_UDP_Programming"><div class="tree-item-contents heading-link" heading-name="Server UDP Programming"><span class="tree-item-title">Server UDP Programming</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#2.7.2_Socket_Programming_with_TCP"><div class="tree-item-contents heading-link" heading-name="2.7.2 Socket Programming with TCP"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.7.2 Socket Programming with TCP</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Client_TCP_Programming"><div class="tree-item-contents heading-link" heading-name="Client TCP Programming"><span class="tree-item-title">Client TCP Programming</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="computer-networking-a-top-down-approach\chapter-2-application-layer.html#Server_TCP_Programming"><div class="tree-item-contents heading-link" heading-name="Server TCP Programming"><span class="tree-item-title">Server TCP Programming</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>